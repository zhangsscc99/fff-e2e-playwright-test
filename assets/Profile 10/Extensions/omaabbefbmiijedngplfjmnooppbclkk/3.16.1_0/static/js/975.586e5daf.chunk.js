"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[975],{75975:(e,n,s)=>{s.r(n),s.d(n,{LedgerContent:()=>k,default:()=>b});var t,r,a,o=s(30168),i=s(80184),l=s(72791),c=s(23098),d=s(61945),u=s(47578),m=s(88754),p=s(29681),h=s(65867),x=s(23470),g=s(35281);const C=h.ZP.div(t||(t=(0,o.Z)(["\n    display: flex;\n    align-items: center;\n    flex-direction: column;\n"]))),f=(0,h.ZP)(x.D)(r||(r=(0,o.Z)(["\n    margin: 1rem 0;\n"]))),v=h.ZP.div(a||(a=(0,o.Z)(["\n    margin-top: 1rem;\n    display: flex;\n    gap: 8px;\n    width: 100%;\n\n    > * {\n        flex: 1;\n    }\n"]))),k=e=>{let{ledgerParams:n,onClose:s,onSubmit:t}=e;const{t:r}=(0,d.$)(),[a,o]=(0,l.useState)(!1),{mutateAsync:c,data:u,isLoading:h,isDeviceConnected:x,reset:k}=(0,p.KO)(),b=()=>{c().then((e=>e.signTransaction(n.path,n.transaction).then((e=>{o(!0),setTimeout((()=>t(e)),500)})).catch((e=>{console.error(e),"object"===typeof e&&"message"in e&&e.message.includes("0x6985")?s(new g.T("Cancel auth request")):s(e)})))).catch(console.debug)};(0,l.useEffect)((()=>{b()}),[]);let w="connect";return x&&(w="open-ton"),u&&(w="confirm-tx"),a&&(w="all-completed"),(0,i.jsxs)(C,{children:[(0,i.jsx)(f,{showConfirmTxStep:!0,currentStep:w}),(0,i.jsxs)(v,{children:[(0,i.jsx)(m.zx,{secondary:!0,onClick:()=>s(new g.T("Cancel auth request")),children:r("cancel")}),(0,i.jsx)(m.zx,{primary:!0,loading:h||!!u||a,onClick:()=>{k(),b()},children:r("try_again")})]})]})},b=()=>{const e=(0,c._H)(),{t:n}=(0,d.$)(),[s,t]=(0,l.useState)(void 0),[r,a]=(0,l.useState)(void 0),o=(0,l.useCallback)((()=>{t(void 0),a(void 0)}),[]),m=(0,l.useCallback)((n=>{e.uiEvents.emit("response",{method:"response",id:r,params:n}),o()}),[e,r,o]),p=(0,l.useCallback)((n=>{r&&e.uiEvents.emit("response",{method:"response",id:r,params:null!==n&&void 0!==n?n:new Error("Unknown Ledger error")}),o()}),[r,e,o]);(0,l.useEffect)((()=>{const n=e=>{t(e.params),a(e.id)};return e.uiEvents.on("ledger",n),()=>{e.uiEvents.off("ledger",n)}}),[e]);const h=(0,l.useCallback)((()=>{if(s&&r)return(0,i.jsx)(k,{ledgerParams:s,onClose:p,onSubmit:m})}),[e,s,r,p,m]);return(0,i.jsx)(u.P_,{isOpen:null!=s&&null!=r,handleClose:()=>p(new g.T("Cancel auth request")),title:n("ledger_connect_header"),children:h})}},35281:(e,n,s)=>{s.d(n,{T:()=>r});var t=s(64572);class r extends Error{constructor(e,n){super(e),(0,t.Z)(this,"cause",void 0),this.name="UserCancelledError",this.cause=n}}}}]);
//# sourceMappingURL=975.586e5daf.chunk.js.map