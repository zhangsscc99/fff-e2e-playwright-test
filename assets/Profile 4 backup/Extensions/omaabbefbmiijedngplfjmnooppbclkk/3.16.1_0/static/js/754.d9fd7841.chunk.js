"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[754],{37460:(e,n,t)=>{t.d(n,{Ao:()=>h,DG:()=>x,Dx:()=>p,Ee:()=>m,kI:()=>u});var s,r,i,o,a,d=t(30168),c=t(65867),l=t(47712);const u=c.ZP.div(s||(s=(0,d.Z)(["\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    margin-bottom: 1rem;\n"]))),m=c.ZP.img(r||(r=(0,d.Z)(["\n    width: 96px;\n    height: 96px;\n    border-radius: ",";\n"])),(e=>e.full?e.theme.cornerFull:e.theme.cornerMedium)),h=c.ZP.div(i||(i=(0,d.Z)(["\n    width: 96px;\n    height: 96px;\n    border-radius: ",";\n    background: ",";\n"])),(e=>e.full?e.theme.cornerFull:e.theme.cornerMedium),(e=>e.theme.backgroundContent)),x=(0,c.ZP)(l.mI)(o||(o=(0,d.Z)(["\n    user-select: none;\n    color: ",";\n    margin: 20px 0 4px;\n"])),(e=>e.theme.textSecondary)),p=(0,c.ZP)(l.H3)(a||(a=(0,d.Z)(["\n    user-select: none;\n    text-align: center;\n"])))},38705:(e,n,t)=>{t.d(n,{CP:()=>V,NG:()=>M,RB:()=>Q,eZ:()=>O,f1:()=>W,mC:()=>U,n_:()=>L,pk:()=>I,tv:()=>H,uq:()=>z,vD:()=>F,vp:()=>D});var s,r,i,o,a=t(30168),d=t(80184),c=t(41235),l=t(1849),u=t(87731),m=t(72791),h=t(65867),x=t(87594),p=t(23098),g=t(61819),v=t(61945),j=t(87812),f=t(5784),_=t(73643),S=t(26503),b=t(47578),w=t(47712),y=t(89050),C=t(59598),k=t(68827),N=t(37460),Z=t(64068),A=t(98502),T=t(35281),P=t(48063);const F=(0,m.createContext)({});function R(){return(0,m.useContext)(F)}function D(e){let{children:n,estimation:t,recipient:s,onBack:r,onClose:i,assetAmount:o,fitContent:a,...l}=e;const{mutateAsync:u,isLoading:h,reset:p}=l,g=(0,c.useQueryClient)(),v=l.error||t.error;let j=(0,d.jsx)(H,{children:(0,d.jsx)(M,{})}),f=(0,d.jsx)(O,{children:(0,d.jsx)(B,{})}),w=(0,d.jsxs)(V,{children:[(0,d.jsx)(L,{}),(0,d.jsx)(I,{}),(0,d.jsx)(Q,{}),(0,d.jsx)(W,{})]}),y=(0,d.jsx)(U,{children:(0,d.jsx)(z,{MainButton:A.y8})});m.Children.map(n,(e=>{if((0,m.isValidElement)(e))switch(e.type){case H:return void(j=e);case O:return void(f=e);case V:return void(w=e);case U:return void(y=e)}}));const[C,k]=(0,m.useState)(!1),{standalone:N}=(0,x.bp)(),Z=async()=>{if(h)return!1;p();try{const e=await u();return e&&(k(!0),setTimeout((()=>{setTimeout((()=>g.invalidateQueries()),100),i(!0)}),2e3)),e}catch(e){return console.error(e),!1}};return(0,d.jsx)(F.Provider,{value:{recipient:s,assetAmount:o,estimation:t,formState:{done:C,isLoading:h,error:v},onClose:()=>i(),onBack:r,handleSubmit:Z},children:(0,d.jsxs)(b.Jz,{onSubmit:async e=>{e.stopPropagation(),e.preventDefault(),Z()},standalone:N,fitContent:a,children:[j,f,(0,d.jsx)(S.L8,{margin:!1,fullWidth:!0,children:w}),(0,d.jsx)(_.Zv,{}),(0,d.jsx)(A.aT,{children:y})]})})}const E=h.ZP.div(s||(s=(0,a.Z)(["\n    margin-bottom: 1rem;\n"]))),H=e=>{let{children:n}=e;return(0,d.jsx)(d.Fragment,{children:n})},M=()=>{const{onClose:e,onBack:n}=R();return(0,d.jsxs)(b.hy,{children:[n?(0,d.jsx)(k.z,{onClick:n,children:(0,d.jsx)(f.wy,{})}):(0,d.jsx)("div",{}),(0,d.jsx)(b.Ho,{handleClose:()=>e()})]})},O=e=>{let{children:n,className:t}=e;return(0,d.jsx)(E,{className:t,children:n})},B=e=>{let{className:n,title:t}=e;const{t:s}=(0,v.$)(),{recipient:r,assetAmount:i}=R(),o=(0,j.vP)(i.asset),a={[l.Ct.id]:s("txActions_signRaw_types_tonTransfer"),[l.tr.id]:s("txActions_USDT_transfer")};t||(t=(0,u.FR)(r)?r.toAccount.name:a[i.asset.id]||s("txActions_signRaw_types_jettonTransfer"));const c=(0,u.FR)(r)&&r.toAccount.icon||o;return(0,d.jsxs)(N.kI,{className:n,children:[c?(0,d.jsx)(N.Ee,{full:!0,src:o}):(0,d.jsx)(N.Ao,{full:!0}),(0,d.jsx)(N.DG,{children:s("confirm_sending_title")}),(0,d.jsx)(N.Dx,{children:t})]})},V=e=>{let{children:n}=e;return(0,d.jsx)(d.Fragment,{children:n})},L=()=>{const{recipient:e}=R();return(0,d.jsx)(Z.AI,{recipient:e})},I=()=>{const{fiat:e}=(0,x.bp)(),{assetAmount:n}=R(),{data:t}=(0,j.Vg)(n),s=t?(0,g.hE)(e,t):void 0;return(0,d.jsx)(Z.Yg,{coinAmount:n.stringAssetRelativeAmount,fiatAmount:s})},Q=()=>{var e;const{estimation:n}=R();return(0,d.jsx)(C.Kk,{fee:n.isFetching||null===(e=n.data)||void 0===e?void 0:e.fee})},W=()=>{const{recipient:e}=R();return(0,u.FR)(e)?(0,d.jsx)(y.Az,{comment:e.comment}):null},$=(0,h.ZP)(f.Jq)(r||(r=(0,a.Z)(["\n    min-width: 32px;\n    min-height: 32px;\n"]))),q=(0,h.ZP)(w.fA)(i||(i=(0,a.Z)(["\n    text-align: center;\n"]))),K=(0,h.ZP)(A.MK)(o||(o=(0,a.Z)(["\n    height: unset;\n    min-height: 56px;\n"]))),U=e=>{let{children:n}=e;return(0,d.jsx)(d.Fragment,{children:n})},z=e=>{let{MainButton:n}=e;const t=(0,p._H)(),{formState:{done:s,error:r,isLoading:i},estimation:{isFetching:o},onClose:a,handleSubmit:c}=R(),{t:l}=(0,v.$)(),u=!i&&!o;return(0,m.useEffect)((()=>{s&&t.hapticNotification("success")}),[s]),(0,m.useEffect)((()=>{r&&t.hapticNotification("error")}),[r]),s?(0,d.jsxs)(A.MK,{done:!0,children:[(0,d.jsx)(f.nS,{}),(0,d.jsx)(w.fA,{children:l("send_screen_steps_done_done_label")})]}):!r||r instanceof T.T?(0,d.jsx)(n,{isDisabled:!u,isLoading:i,onClick:c,onClose:a}):(0,d.jsxs)(K,{children:[(0,d.jsx)($,{}),(0,d.jsx)(q,{children:r instanceof P.E?r.message:l("send_publish_tx_error")})]})}},86749:(e,n,t)=>{t.d(n,{Aq:()=>re,gW:()=>ee});var s,r,i=t(30168),o=t(80184),a=t(41235),d=t(14182),c=t(97284),l=t(20220),u=t(72791),m=t(65867),h=t(87594),x=t(23098),p=t(42770),g=t(61945),v=t(39120),j=t(97957),f=t(73643),_=t(47578),S=t(47712),b=t(90820),w=t(5784),y=t(96423);const C=m.ZP.div(s||(s=(0,i.Z)(["\n    position: absolute;\n    right: 1rem;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n    color: ",";\n\n    &:hover {\n        color: ",";\n    }\n"])),(e=>e.theme.textSecondary),(e=>e.theme.textTertiary)),k=m.ZP.div(r||(r=(0,i.Z)(["\n    position: absolute;\n    right: 1rem;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n\n    color: ",";\n"])),(e=>e.theme.accentBlue)),N=u.forwardRef(((e,n)=>{let{value:t,onChange:s,isValid:r=!0,label:i,disabled:a,onScan:d,onSubmit:c}=e;const[l,m]=(0,u.useState)(!1),[p,g]=(0,u.useState)(void 0),v=(0,x._H)(),{hideQrScanner:j}=(0,h.bp)();return(0,u.useEffect)((()=>{const e=e=>{e.id===p&&d(e.params)};return v.uiEvents.on("response",e),()=>{v.uiEvents.off("response",e)}}),[v,p,d]),(0,o.jsxs)(b.S7,{focus:l,valid:r,scanner:!0,children:[(0,o.jsx)(y.u,{onSubmit:c,ref:n,disabled:a,value:t,onChange:e=>s&&s(e.target.value),onFocus:()=>m(!0),onBlur:()=>m(!1)}),i&&(0,o.jsx)(b.__,{active:""!==t,children:i}),""===t?!0===j?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(k,{onClick:e=>{if(e.stopPropagation(),e.preventDefault(),a)return;const n=Date.now();v.uiEvents.emit("scan",{method:"scan",id:n,params:void 0}),g(n)},children:(0,o.jsx)(w.bJ,{})}):(0,o.jsx)(C,{onClick:e=>{e.stopPropagation(),e.preventDefault(),a||null===s||void 0===s||s("")},children:(0,o.jsx)(w.wq,{})})]})}));var Z,A,T=t(81987);const P=m.ZP.div(Z||(Z=(0,i.Z)(["\n    position: relative;\n    width: 100%;\n"]))),F=(0,m.ZP)(S.mI)(A||(A=(0,i.Z)(["\n    position: absolute;\n    bottom: 0;\n    line-height: 46px;\n    left: ","px;\n    color: ",";\n    user-select: none;\n"])),(e=>Math.ceil(e.inputTextWidth)+46),(e=>e.theme.textSecondary)),R=e=>{let{value:n,children:t}=e;return(0,o.jsxs)(P,{children:[t,n&&(0,o.jsx)(F,{inputTextWidth:n.inputTextWidth,children:n.value})]})};var D,E,H,M=t(79297),O=t(5169),B=t(79309),V=t(26503),L=t(29857),I=t(37562);const Q=(0,m.ZP)(S.RV)(D||(D=(0,i.Z)(["\n    user-select: none;\n    width: 100%;\n    margin-top: 12px;\n    margin-bottom: -4px;\n"]))),W=m.ZP.span(E||(E=(0,i.Z)(["\n    display: flex;\n    color: ",";\n\n    padding: 8px;\n    margin: -8px;\n"])),(e=>e.theme.iconSecondary)),$=m.ZP.span(H||(H=(0,i.Z)(["\n    display: inline-flex;\n    color: ",";\n"])),(e=>e.theme.accentBlue)),q=e=>{let{item:n,onSelect:t,onEdit:s}=e;const r=(0,x._H)(),{mutateAsync:i}=(e=>{const n=(0,x._H)(),t=(0,h.tN)(),s=(0,a.useQueryClient)();return(0,a.useMutation)((async()=>{await(0,O.T$)(n.storage,t.publicKey,e.address),await s.invalidateQueries([t.active.rawAddress,j.S8.activity,"suggestions"])}))})(n),{t:d}=(0,g.$)(),c=(0,I.R)(n);return(0,o.jsx)(V.HC,{onClick:()=>t(n),children:(0,o.jsxs)(V.me,{children:[(0,o.jsx)(f.Uc,{noWrap:!0,text:(0,o.jsxs)(o.Fragment,{children:[n.name," ",(0,o.jsx)($,{children:(0,o.jsx)(w.r7,{})})]}),secondary:(0,l.FN)(c)}),(0,o.jsx)(B.vb,{payload:e=>(0,o.jsxs)(V.L8,{margin:!1,dropDown:!0,children:[(0,o.jsx)(V.HC,{dropDown:!0,onClick:t=>{t.stopPropagation(),s(n),e()},children:(0,o.jsx)(V.me,{children:(0,o.jsx)(S.RV,{children:d("add_edit_favorite_edit_title")})})}),(0,o.jsx)(V.HC,{dropDown:!0,onClick:t=>{t.stopPropagation(),r.confirm(d("send_screen_steps_address_delete_alert_text").replace("%{name}",n.name)).then((e=>{if(e)return i()})).finally((()=>{e()}))},children:(0,o.jsx)(V.me,{children:(0,o.jsx)(S.RV,{children:d("add_edit_favorite_delete")})})})]}),children:(0,o.jsx)(W,{children:(0,o.jsx)(w.ws,{})})})]})},n.address)},K=e=>{let{item:n,onSelect:t,onAddFavorite:s}=e;const{mutateAsync:r}=(e=>{const n=(0,x._H)(),t=(0,h.tN)(),s=(0,a.useQueryClient)();return(0,a.useMutation)((async()=>{await(0,O.nS)(n.storage,t.publicKey,e.address),await s.invalidateQueries([t.active.rawAddress,j.S8.activity,"suggestions"])}))})(n),{t:i,i18n:d}=(0,g.$)(),c=(0,I.R)(n);return(0,o.jsx)(V.HC,{onClick:()=>t(n),children:(0,o.jsxs)(V.me,{children:[(0,o.jsx)(f.Uc,{text:(0,l.FN)(c),secondary:(u=(0,M.l1)(d.language),m=n.timestamp,new Intl.DateTimeFormat((0,M.l1)(u),{day:"numeric",month:"long"}).format(new Date(m)))}),(0,o.jsx)(B.vb,{payload:e=>(0,o.jsxs)(V.L8,{margin:!1,dropDown:!0,children:[(0,o.jsx)(V.HC,{dropDown:!0,onClick:t=>{t.stopPropagation(),s(n),e()},children:(0,o.jsx)(V.me,{children:(0,o.jsx)(S.RV,{children:i("send_screen_steps_address_suggest_actions_add")})})}),(0,o.jsx)(V.HC,{dropDown:!0,onClick:n=>{n.stopPropagation(),r().finally((()=>e()))},children:(0,o.jsx)(V.me,{children:(0,o.jsx)(S.RV,{children:i("send_screen_steps_address_suggest_actions_hide")})})})]}),children:(0,o.jsx)(W,{children:(0,o.jsx)(w.ws,{})})})]})},n.address);var u,m},U=e=>{let{onSelect:n,disabled:t,acceptBlockchains:s}=e;const r=(0,x._H)(),{t:i}=(0,g.$)(),{data:d}=(e=>{const n=(0,x._H)(),{api:t}=(0,h.bp)(),s=(0,h.tN)();return(0,a.useQuery)([s.active.rawAddress,j.S8.activity,"suggestions",e],(()=>(0,O.hm)(n,t,s,e)),{keepPreviousData:!0})})(s);return d?(0,o.jsxs)(o.Fragment,{children:[d.length>0?(0,o.jsx)(Q,{children:i("send_screen_steps_address_suggests_label")}):void 0,(0,o.jsx)(V.L8,{margin:!1,fullWidth:!0,noUserSelect:!0,children:d.map((e=>e.isFavorite?(0,o.jsx)(q,{item:e,onSelect:e=>!t&&n(e),onEdit:e=>{t||r.uiEvents.emit("editSuggestion",{method:"editSuggestion",params:e})}},e.address):(0,o.jsx)(K,{item:e,onSelect:e=>!t&&n(e),onAddFavorite:e=>{t||r.uiEvents.emit("addSuggestion",{method:"addSuggestion",params:e})}},e.address)))})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Q,{children:i("send_screen_steps_address_suggests_label")}),(0,o.jsx)(L.eM,{size:4,margin:!1,fullWidth:!0})]})};var z,J=t(98502),G=t(82430),X=t(29681);const Y=(0,m.ZP)(S.pN)(z||(z=(0,i.Z)(["\n    user-select: none;\n    display: block;\n    width: 100%;\n    margin-top: -4px;\n    color: ",";\n"])),(e=>e.theme.accentOrange)),ee=()=>{const{api:e}=(0,h.bp)();return(0,a.useMutation)((n=>{const t="dns"in n?n.dns.address:n.address;return new c.HOX(e.tonApiV2).getAccount({accountId:t})}))},ne=e=>{const{api:n}=(0,h.bp)(),[t,s]=(0,u.useState)("");return(0,u.useMemo)((()=>(0,l.Ds)((e=>s(e)),400)),[s])(e),(0,a.useQuery)([j.S8.dns,e,t],(async()=>{if(e!==t)return null;let s=t.trim();if((e=>e.length<8||48===e.length||52===e.length||(0,l.Ig)(e)||(0,l.nl)(e))(s))return null;s=s.toString().toLowerCase();const r=await new c.TuR(n.tonApiV2).dnsResolve({domainName:s});return r.wallet?r.wallet:null}),{retry:0,keepPreviousData:!1})},te=e=>"dns"in e||(0,l.Ig)(e.address),se={address:""},re=e=>{var n;let{data:t,setRecipient:s,keyboard:r,onScan:i,isExternalLoading:m,acceptBlockchains:S,HeaderBlock:w,fitContent:y,isAnimationProcess:C}=e;const k=(0,x._H)(),[Z,A]=(0,u.useState)(!1),P=(0,h.tN)(),{t:F}=(0,g.$)(),{standalone:D,ios:E}=(0,h.bp)(),H=(0,u.useRef)(null),M=(0,G.c)()&&C,[O,B]=(0,u.useState)(t&&"comment"in t?t.comment:""),[V,L]=(0,u.useState)(null!==(n=null===t||void 0===t?void 0:t.address)&&void 0!==n?n:se),{data:I,isFetching:Q}=ne(V.address);(0,u.useEffect)((()=>{const e=setTimeout((()=>(0,v.k3)()),300);return()=>{clearTimeout(e)}}),[]),(0,u.useEffect)((()=>{I&&L((e=>({address:e.address,dns:I,dnsName:e.address.toLowerCase()}))),null==I&&L((e=>"dns"in e?{address:e.address}:e))}),[L,I]);const W=(0,u.useMemo)((()=>{if(S&&1===S.length)return S[0];let e;return te(V)?e=d.S.TON:(0,l.nl)(V.address)&&(e=d.S.TRON),!S||e&&S.includes(e)?e:null}),[V]),$=(0,u.useMemo)((()=>!S||1!==S.length||(S[0]===d.S.TON?te(V):(0,l.nl)(V.address))),[S,V]),{data:q,isFetching:K}=((e,n)=>{const{api:t}=(0,h.bp)(),s="dns"in n?n.dns.address:n.address;return(0,a.useQuery)([j.S8.account,s],(()=>new c.HOX(t.tonApiV2).getAccount({accountId:s})),{enabled:e})})(W===d.S.TON&&te(V),V),z=K||m,ee=(0,X.vO)(),re=(0,u.useMemo)((()=>ee?/^[ -~]*$/gm.test(O):!q||(!q.memoRequired||O.length>0)),[q,O,ee]);(0,u.useEffect)((()=>{k.isIOs()||H.current&&H.current.focus()}),[H.current]);const ie=(0,u.useMemo)((()=>"isFavorite"in V?V.blockchain===d.S.TRON?V.address:(0,l.Tg)(V.address,P.network):"dnsName"in V&&"string"===typeof V.dnsName?V.dnsName:V.address),[V]),oe=((e,n,t)=>{var s;const r=(0,h.tN)(),i=null!==(s=null===t||void 0===t?void 0:t.address)&&void 0!==s?s:void 0,[o,a]=(0,u.useState)(void 0),d=(0,T.Z)({text:n,font:"16px sans-serif"}),c=(0,T.Z)({text:i?(0,l.FN)(i):void 0,font:"16px sans-serif"});return(0,u.useEffect)((()=>{e.current&&t&&!isNaN(d)&&!isNaN(c)&&e.current.clientWidth-48-d-c>0?a({inputTextWidth:d,addressTextWidth:c,value:(0,l.FN)((0,l.Tg)(t.address,r.network))}):a(void 0)}),[e.current,t,d,c]),o})(H,ie,q),ae=()=>{let e;switch(A(!0),W){case d.S.TON:e=re&&q;break;case d.S.TRON:e=(0,l.nl)(V.address)}e?(E&&r&&(0,p.Q)(r),W===d.S.TON?s({address:{...V,blockchain:d.S.TON},toAccount:q,comment:O,done:!0}):s({address:{...V,blockchain:d.S.TRON},done:!0})):k.hapticNotification("error")};return(0,o.jsxs)(_.r4,{onSubmit:e=>{e.stopPropagation(),e.preventDefault(),ae()},standalone:D,fitContent:y,noPadding:!0,children:[!M&&(0,o.jsx)(_.JE,{children:(0,o.jsx)(_.O$,{children:(0,o.jsx)(w,{})})}),(0,o.jsx)(R,{value:oe,children:(0,o.jsx)(N,{onSubmit:ae,ref:H,value:ie,onScan:i,onChange:e=>L({address:e}),label:F("transaction_recipient_address"),isValid:!Z||!!W&&$,disabled:m})}),W!==d.S.TRON&&(0,o.jsx)(b.Kx,{onSubmit:ae,value:O,onChange:B,label:F("txActions_signRaw_comment"),isValid:!Z||re,disabled:m}),q&&q.memoRequired&&(0,o.jsx)(Y,{children:F("send_screen_steps_comfirm_comment_required_text")}),(0,o.jsx)(U,{onSelect:async e=>{var n;e.blockchain===d.S.TON&&(e.address=(0,l.Tg)(e.address,P.network)),L(e),null===(n=H.current)||void 0===n||n.focus()},disabled:m,acceptBlockchains:S}),(0,o.jsx)(f.Zv,{}),!M&&(0,o.jsx)(_.gH,{children:(0,o.jsx)(_.B6,{children:(0,o.jsx)(J.c7,{isLoading:z||Q,onClick:ae})})})]})}},81987:(e,n,t)=>{t.d(n,{Z:()=>o,m:()=>i});var s=t(72791);const r=()=>{const e=document.createDocumentFragment(),n=document.createElement("canvas");return e.appendChild(n),n.getContext("2d")},i=(e,n)=>{const t=r();if(t.font=n,Array.isArray(e))return Math.max(...e.map((e=>t.measureText(e).width)));return t.measureText(e).width},o=e=>{const n=(0,s.useMemo)((()=>"text"in e?e:void 0),[e]),t=(0,s.useMemo)((()=>"ref"in e?e:void 0),[e]);return(0,s.useMemo)((()=>{var e,s;if(null!==t&&void 0!==t&&null!==(e=t.ref.current)&&void 0!==e&&e.textContent){const e=r(),n=window.getComputedStyle(t.ref.current);e.font=n.font;return e.measureText(t.ref.current.textContent).width}return null!==n&&void 0!==n&&n.text?i(n.text,null!==(s=n.font)&&void 0!==s?s:"16px times"):NaN}),[null===n||void 0===n?void 0:n.text,null===n||void 0===n?void 0:n.font,null===t||void 0===t?void 0:t.ref])}},35281:(e,n,t)=>{t.d(n,{T:()=>r});var s=t(64572);class r extends Error{constructor(e,n){super(e),(0,s.Z)(this,"cause",void 0),this.name="UserCancelledError",this.cause=n}}}}]);
//# sourceMappingURL=754.d9fd7841.chunk.js.map