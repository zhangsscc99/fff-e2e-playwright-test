"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[823],{90648:(e,t,n)=>{n.d(t,{f:()=>i});var s=n(80184),a=n(23098),r=n(2346),o=n(56445);const i=e=>{let{chain:t,jetton:n}=e;const i=(0,a._H)();return(0,s.jsx)(r.a,{icon:(0,s.jsx)(o.Iy,{}),title:"wallet_receive",action:()=>i.uiEvents.emit("receive",{method:"receive",params:{chain:t,jetton:n}})})}},83627:(e,t,n)=>{n.d(t,{Q:()=>m});var s,a=n(30168),r=n(80184),o=n(2346),i=n(5784),d=n(35976),c=n(65867),l=n(53006);const u=(0,c.zo)(i.Td)(s||(s=(0,a.Z)(["\n    height: 24px;\n    width: 24px;\n    color: ",";\n"])),(e=>e.theme.iconPrimary)),m=e=>{let{fromAsset:t}=e;const[n,s]=(0,d.J)(),[a,i]=(0,l.g7)();return(0,r.jsx)(o.a,{icon:(0,r.jsx)(u,{}),title:"swap_title",action:()=>{t&&i(t),s(!0)}})}},72884:(e,t,n)=>{n.d(t,{P:()=>l});var s=n(80184),a=n(38236),r=n(2346),o=n(94221),i=n(90648),d=n(83627),c=n(1849);const l=e=>{let{chain:t}=e;return(0,s.jsxs)(r.G,{children:[(0,s.jsx)(o.Jh,{}),(0,s.jsx)(a.Q,{asset:"TON",chain:t}),(0,s.jsx)(i.f,{}),(0,s.jsx)(d.Q,{fromAsset:c.Ct})]})}},38236:(e,t,n)=>{n.d(t,{Q:()=>i});var s=n(80184),a=n(23098),r=n(2346),o=n(56445);const i=e=>{let{asset:t,chain:n}=e;const i=(0,a._H)();return(0,s.jsx)(r.a,{icon:(0,s.jsx)(o.jE,{}),title:"wallet_send",action:()=>i.uiEvents.emit("transfer",{method:"transfer",id:Date.now(),params:{asset:t,chain:n}})})}},20823:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var s=n(80184),a=n(72791),r=n(57689),o=n(29305),i=n(41235),d=n(11707),c=n(14182),l=n(97284),u=n(93853),m=n(99326),p=n(29857),x=n(75594),f=n(97541),g=n(2346),h=n(90648),v=n(46574),j=n(38236),y=n(87594),A=n(61819),b=n(71757),w=n(97957),S=n(7393),N=n(57443),P=n(83627),T=n(48544),F=n(20504);const O=e=>{let{balance:t,innerRef:n}=e;const{api:a,standalone:r}=(0,y.bp)(),o=(0,y.tN)(),{isFetched:d,hasNextPage:c,data:u,isFetchingNextPage:m,fetchNextPage:p}=(0,i.useInfiniteQuery)({queryKey:[t.walletAddress.address,w.S8.activity,w.kg.history],queryFn:e=>{let{pageParam:n}=e;return new l.HOX(a.tonApiV2).getAccountJettonHistoryByID({accountId:o.active.rawAddress,jettonId:t.jetton.address,limit:20,beforeLt:n})},getNextPageParam:e=>e.nextFrom>0?e.nextFrom:void 0});return(0,b.N)(c,m,p,r,n),(0,s.jsx)(f.b,{isFetched:d,isFetchingNextPage:m,tonEvents:u})},_=e=>{let{info:t,balance:n}=e;const[r,o]=(0,a.useMemo)((()=>[(0,u.og)(n.balance,t.metadata.decimals),d.Address.parse(n.jetton.address).toString()]),[t,n]),{data:i}=(0,N.UJ)(o),c=(0,A.PL)(r,t.metadata.decimals),{fiatAmount:l}=(0,N.to)(i,r),{description:m,image:p}=t.metadata;return(0,s.jsx)(v.f,{amount:c,symbol:t.metadata.symbol,price:l,description:m,image:p})},E=e=>{let{jettonAddress:t}=e;const{data:n}=(0,S.up)(t),{data:r}=(0,S.he)(t),{data:o}=(0,F.Iy)(),i=d.Address.parse(t).toRawString(),l=null===o||void 0===o?void 0:o.find((e=>(0,T.J)(e.address)===i)),u=(0,a.useRef)(null);return n&&r&&o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.bU,{title:n.metadata.name}),(0,s.jsxs)(m.HV,{ref:u,children:[(0,s.jsx)(_,{balance:r,info:n}),(0,s.jsxs)(g.G,{children:[(0,s.jsx)(j.Q,{asset:n.metadata.address,chain:c.S.TON}),(0,s.jsx)(h.f,{jetton:n.metadata.address}),l&&(0,s.jsx)(P.Q,{fromAsset:l})]}),(0,s.jsx)(O,{balance:r,innerRef:u})]})]}):(0,s.jsx)(p.vW,{})};var k=n(72884),C=n(61945);const U=e=>{return"TonTransfer"===e.type||!("ContractDeploy"!==e.type||null===(t=e.contractDeploy)||void 0===t||null===(t=t.interfaces)||void 0===t||!t.includes("wallet"));var t};var R=n(91153);const I=e=>{let{info:{balance:t}}=e;const{t:n}=(0,C.$)(),r=(0,a.useMemo)((()=>(0,u.og)(t)),[t]),o=(0,A.PL)(r),{data:i}=(0,N.UJ)(c.C.TON),{fiatAmount:d}=(0,N.to)(i,r);return(0,s.jsx)(v.f,{amount:o,symbol:"TON",price:d,description:n("Ton_page_description"),image:"https://wallet.tonkeeper.com/img/toncoin.svg"})},Q=()=>{const{t:e}=(0,C.$)(),t=(0,a.useRef)(null),{data:n}=(0,R.IR)(),{api:r,standalone:o}=(0,y.bp)(),d=(0,y.tN)(),{fetchNextPage:u,hasNextPage:g,isFetchingNextPage:h,data:v,isFetched:j}=(0,i.useInfiniteQuery)({queryKey:[d.active.rawAddress,w.S8.activity,"ton"],queryFn:e=>{let{pageParam:t}=e;return new l.HOX(r.tonApiV2).getAccountEvents({accountId:d.active.rawAddress,limit:20,beforeLt:t,subjectOnly:!0})},getNextPageParam:e=>e.nextFrom>0?e.nextFrom:void 0});(0,b.N)(g,h,u,o,t);const A=(0,a.useMemo)((()=>v?(e=>({pages:e.pages.reduce(((e,t)=>{const n=t.events.reduce(((e,t)=>(t.actions.every(U)&&e.push(t),e)),[]);return n.length&&e.push({events:n,nextFrom:0}),e}),[]),pageParams:[]}))(v):void 0),[v]);return n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.bU,{title:e("Toncoin")}),(0,s.jsxs)(m.HV,{ref:t,children:[(0,s.jsx)(I,{info:n}),(0,s.jsx)(k.P,{chain:c.S.TON}),(0,s.jsx)(f.b,{isFetched:j,isFetchingNextPage:h,tonEvents:A})]})]}):(0,s.jsx)(p.vW,{activity:4})};var q,W,Z=n(30168),M=n(56320),H=n(65867),J=n(47712),L=n(35300);const G=e=>{let{tronBalance:{token:t,weiAmount:n}}=e;const r=(0,a.useMemo)((()=>(0,u.og)(n,t.decimals)),[n,t]),o=(0,A.PL)(r,t.decimals),{data:i}=(0,N.UJ)(t.symbol),{fiatAmount:d}=(0,N.to)(i,r);return(0,s.jsx)(v.f,{amount:o,symbol:t.symbol,price:d,image:t.image})},B=e=>{let{tron:t,innerRef:n}=e;const a=(0,y.tN)(),{standalone:r,api:{tronApi:o}}=(0,y.bp)(),{data:d,isFetched:c,isFetchingNextPage:l,hasNextPage:u,fetchNextPage:m}=(0,i.useInfiniteQuery)({queryKey:[t.ownerWalletAddress,a.network,w.S8.tron],queryFn:e=>{let{pageParam:n}=e;return new M.An(o).getTransactions({ownerAddress:t.ownerWalletAddress,fingerprint:n,limit:100})},getNextPageParam:e=>e.fingerprint});return(0,b.N)(u,l,m,r,n),(0,s.jsx)(f.b,{isFetched:c,isFetchingNextPage:l,tronEvents:d})},K=H.ZP.div(q||(q=(0,Z.Z)(["\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    line-height: 22px;\n"]))),V=(0,H.ZP)(J.pN)(W||(W=(0,Z.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),D=e=>{let{tron:t}=e;const{address:n}=(0,r.UO)(),i=(0,r.s0)(),{data:d,isLoading:l,isError:u}=(0,L._G)(t,n);(0,a.useEffect)((()=>{u&&i(o.FR.home)}),[u]);const f=(0,a.useRef)(null);return l||!d?(0,s.jsx)(p.vW,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.bU,{title:(0,s.jsxs)(K,{children:[(0,s.jsx)("div",{children:d.token.name}),(0,s.jsx)(V,{children:"TRC20"})]})}),(0,s.jsxs)(m.HV,{ref:f,children:[(0,s.jsx)(G,{tronBalance:d}),(0,s.jsxs)(g.G,{children:[(0,s.jsx)(j.Q,{asset:"TON",chain:c.S.TRON}),(0,s.jsx)(h.f,{chain:c.S.TRON})]}),(0,s.jsx)(B,{tron:t,innerRef:f})]})]})},X=()=>{const e=(0,r.s0)(),{data:t,isLoading:n,isError:i}=(0,L.yw)();return(0,a.useEffect)((()=>{i&&e(o.FR.home)}),[i]),n||!t?(0,s.jsx)(p.vW,{}):(0,s.jsx)(r.Z5,{children:(0,s.jsx)(r.AW,{path:":address",element:(0,s.jsx)(D,{tron:t})})})},$=()=>{const e=(0,r.s0)(),{name:t}=(0,r.UO)();return(0,a.useEffect)((()=>{t||e(o.FR.home)}),[t]),t?"tron"===t?(0,s.jsx)(X,{}):"ton"===t?(0,s.jsx)(Q,{}):(0,s.jsx)(E,{jettonAddress:decodeURIComponent(t)}):(0,s.jsx)(s.Fragment,{})}},20504:(e,t,n)=>{n.d(t,{Iy:()=>w,L:()=>N,UE:()=>T,bB:()=>O,r7:()=>P});var s=n(41235),a=n(11707),r=n(86445),o=n(14182),i=n(76978),d=n(39079),c=n(48544),l=n(97284),u=n(93853),m=n(20220),p=n(34692),x=n(72791),f=n(87594),g=n(23098),h=n(72119),v=n(97957),j=n(60793),y=n(7393),A=n(57443),b=n(94216);function w(){const{swapService:e}=(0,b.W)(),{data:t}=F();return(0,s.useQuery)({queryKey:[v.S8.swapAllAssets,t],queryFn:async()=>{try{const n=await e.swapAssets();return n.map((e=>{const t="ton"===e.address?"TON":a.Address.parse(e.address);return{id:(0,d.G)(o.S.TON,t),symbol:e.symbol,decimals:e.decimals,name:e.name,image:e.image,blockchain:o.S.TON,address:t}})).filter((e=>!(t||[]).some((t=>t.id===e.id)))).concat(t||[])}catch(n){return console.error(n),[]}},enabled:!!t})}const S=(0,h.cn)("");function N(){return(0,h.KO)(S)}const P=()=>{const[e]=N(),{data:t}=function(){const[e]=(0,j.L)(),{data:t}=w(),{data:n}=(0,A.UJ)(o.C.TON),{fiat:r}=(0,f.bp)();return(0,s.useQuery)({queryKey:[v.S8.swapWalletAssets,t,e,n,r],queryFn:async()=>{if(!e||!t||!n)return[];const s=t.map((t=>{var s;if((0,c.kC)(t.address))return{assetAmount:new i.n({asset:t,weiAmount:e.ton.info.balance}),fiatAmount:(0,u.PE)(new p.Z(e.ton.info.balance)).multipliedBy(n.prices)};const o=e.ton.jettons.balances.find((e=>a.Address.parse(e.jetton.address).equals(t.address)));return{assetAmount:new i.n({asset:t,weiAmount:(null===o||void 0===o?void 0:o.balance)||0}),fiatAmount:(0,u.PE)(new p.Z((null===o||void 0===o?void 0:o.balance)||0),t.decimals).multipliedBy(new p.Z((null===o||void 0===o||null===(s=o.price)||void 0===s||null===(s=s.prices)||void 0===s?void 0:s[r])||0))}}));return s.sort(((e,t)=>e.fiatAmount.isZero()&&t.fiatAmount.isZero()?t.assetAmount.weiAmount.comparedTo(e.assetAmount.weiAmount):t.fiatAmount.comparedTo(e.fiatAmount))),s},enabled:!!e&&!!t&&!!n})}();return(0,x.useMemo)((()=>{if(t)return t.filter((t=>{var n;if(!e)return!0;if((0,m.Ig)(e))return a.Address.parse(e).equals(t.assetAmount.asset.address);const s=e.toUpperCase();return!!(t.assetAmount.asset.symbol.toUpperCase().includes(s)||null!==(n=t.assetAmount.asset.name)&&void 0!==n&&n.toUpperCase().includes(s))||void 0}))}),[e,t])},T=()=>{const[e]=N(),t=(0,m.Ig)(e),{api:n,fiat:r}=(0,f.bp)(),{data:c}=(0,y.NR)();return(0,s.useQuery)({queryKey:[v.S8.swapCustomToken,e,c,r],queryFn:async()=>{if(!t)return null;try{var s;const t=a.Address.parse(e),m=await new l.EkG(n.tonApiV2).getJettonInfo({accountId:t.toRawString()}),x={address:t,image:m.metadata.image,blockchain:o.S.TON,name:m.metadata.name,symbol:m.metadata.symbol,decimals:Number(m.metadata.decimals),id:(0,d.G)(o.S.TON,t)},f=null===c||void 0===c?void 0:c.balances.find((e=>a.Address.parse(e.jetton.address).equals(t)));return{assetAmount:new i.n({asset:x,weiAmount:(null===f||void 0===f?void 0:f.balance)||new p.Z(0)}),fiatAmount:(0,u.PE)(new p.Z((null===f||void 0===f?void 0:f.balance)||0),x.decimals).multipliedBy(new p.Z((null===f||void 0===f||null===(s=f.price)||void 0===s||null===(s=s.prices)||void 0===s?void 0:s[r])||0))}}catch(m){return console.error(m),null}},enabled:t&&!!c})},F=()=>{const e=(0,g._H)();return(0,s.useQuery)([r.l.SWAP_CUSTOM_ASSETS],(async()=>{const t=await e.storage.get(r.l.SWAP_CUSTOM_ASSETS);return(null===t||void 0===t?void 0:t.map((e=>({...e,blockchain:e.blockchain,address:(0,c.Wx)(e.address),id:(0,d.G)(e.blockchain,e.address)}))))||[]}))},O=()=>{const e=(0,g._H)(),t=(0,s.useQueryClient)();return(0,s.useMutation)((async n=>{const s=await e.storage.get(r.l.SWAP_CUSTOM_ASSETS)||[];await e.storage.set(r.l.SWAP_CUSTOM_ASSETS,[...s,{...n,address:(0,c.J)(n.address)}]),await t.invalidateQueries([r.l.SWAP_CUSTOM_ASSETS])}))}}}]);
//# sourceMappingURL=823.a0af3266.chunk.js.map