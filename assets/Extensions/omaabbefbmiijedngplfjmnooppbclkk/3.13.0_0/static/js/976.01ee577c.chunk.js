"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[976],{9356:(t,e,s)=>{s.d(e,{A:()=>a});var r=s(11707);function a(t,e){if(t&&t===e)return!0;try{return!!e&&("string"===typeof t&&(t=r.Address.parse(t)),"string"===typeof e&&(e=r.Address.parse(e)),t.equals(e))}catch(s){return!1}}},72119:(t,e,s)=>{s.d(e,{KO:()=>i,cn:()=>o});var r=s(64572),a=s(72791);class n{get value(){return this._value}constructor(t){(0,r.Z)(this,"_value",void 0),(0,r.Z)(this,"subscribers",[]),this._value=t}subscribe(t){return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}next(t){this._value=t,this.subscribers.forEach((e=>e(t)))}}const o=t=>new n(t);function i(t){const[e,s]=(0,a.useState)(t.value);(0,a.useEffect)((()=>(s(t.value),t.subscribe((t=>{s(t)})))),[t]);return[e,(0,a.useCallback)((e=>{"function"===typeof e&&(e=e(t.value)),t.next(e)}),[t])]}},53006:(t,e,s)=>{s.d(e,{DC:()=>T,Fu:()=>m,K4:()=>S,MT:()=>A,RM:()=>C,dN:()=>w,g7:()=>b,vB:()=>f,xP:()=>v,y:()=>Z});var r=s(1849),a=s(48544),n=s(34692),o=s(72119),i=s(41235),c=s(97957),u=s(60793),l=s(57443),d=s(94216),h=s(72791),p=s(9356);const v=(0,o.cn)(r.Ct),f=(0,o.cn)(r.FS),y=(0,o.cn)(new n.Z(1)),b=()=>{const[t,e]=(0,o.KO)(v),[s,r]=(0,o.KO)(f);return[t,(0,h.useCallback)((t=>{(0,p.A)(t.address,f.value.address)&&r(v.value),e(t)}),[e,r])]},w=()=>{const[t,e]=(0,o.KO)(f),[s,r]=(0,o.KO)(v);return[t,(0,h.useCallback)((t=>{(0,p.A)(t.address,v.value.address)&&r(f.value),e(t)}),[e,r])]},Z=()=>(0,o.KO)(y),m=()=>{const{data:t,isError:e}=E(),[s]=b(),a=(0,u.h)(s);return(0,i.useQuery)({queryKey:[c.S8.swapMaxValue,t,s.id,null===a||void 0===a?void 0:a.toFixed(0)],queryFn:async()=>{if(e)return a;if(a&&t){if(s.id===r.Ct.id){const e=new n.Z(t.dedust.tonToJetton),s=new n.Z(t.stonfi.tonToJetton),r=a.minus(n.Z.max(e,s)).minus(1e6);return r.lt(0)?new n.Z(0):r}return a}},enabled:(!!t||e)&&void 0!==a})},E=()=>{const{swapService:t}=(0,d.W)();return(0,i.useQuery)({queryKey:[c.S8.swapGasConfig],queryFn:async()=>t.swapGas()})},g=(0,o.cn)(void 0),S=()=>(0,o.KO)(g),A=()=>{const[t]=b(),[e]=w(),[s]=S(),{data:r,isLoading:o}=(0,l.UJ)((0,a.J)(t.address)),{data:i,isLoading:c}=(0,l.UJ)((0,a.J)(e.address)),u=null===s||void 0===s?void 0:s.trade;if(!u||c||o)return;if(null===r||void 0===r||!r.prices||null===i||void 0===i||!i.prices)return null;const d=new n.Z(u.from.relativeAmount).multipliedBy(r.prices),h=new n.Z(u.to.relativeAmount).multipliedBy(i.prices);return d.isEqualTo(h)?new n.Z(0):d.minus(h).dividedBy(d)},T=t=>t?t.isGreaterThan(.05)?"high":t.isGreaterThan(.01)?"medium":"low":"unknown",C=()=>{const[t]=Z();return!t||t.isZero()}},35976:(t,e,s)=>{s.d(e,{J:()=>p});var r=s(72119),a=s(72791),n=s(94216),o=s(23098),i=s(53006),c=s(87594),u=s(48544);const l=(t,e,s,r)=>{const a=new URL("https://app.ston.fi/swap");return a.searchParams.append("ft",d(t)),a.searchParams.append("tt",d(e)),a.searchParams.append("referral_address",r||""),a.searchParams.append("utm_source","tokeeper-".concat(s)),a.searchParams.append("utm_medium","organic"),a.searchParams.append("utm_campaign","swap_button"),a.searchParams.append("utm_content","TODO"),a.toString()},d=t=>(0,u.kC)(t)?"ton":t.toString({urlSafe:!0}),h=(0,r.cn)(!1),p=()=>{const[t,e]=(0,r.KO)(h),{isSwapsEnabled:s}=(0,n.W)(),u=(0,o._H)(),{tonendpoint:d,env:p}=(0,c.bp)();return[t,(0,a.useCallback)((t=>{if(t&&!s){const t=l(i.xP.value.address,i.vB.value.address,d.targetEnv,null===p||void 0===p?void 0:p.stonfiReferralAddress);u.openPage(t)}else e(t)}),[e,s,u,d.targetEnv,null===p||void 0===p?void 0:p.stonfiReferralAddress])]}},94216:(t,e,s)=>{s.d(e,{W:()=>P});var r=s(87594),a=s(72346),n=s(86033),o=s(13092);let i;class c extends Error{constructor(t){super(t),this.name="CancelError"}get isCancelled(){return!0}}var u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap,v=new WeakMap,f=new WeakMap;i=Symbol.toStringTag;class y{constructor(t){(0,a.Z)(this,u,{writable:!0,value:void 0}),(0,a.Z)(this,l,{writable:!0,value:void 0}),(0,a.Z)(this,d,{writable:!0,value:void 0}),(0,a.Z)(this,h,{writable:!0,value:void 0}),(0,a.Z)(this,p,{writable:!0,value:void 0}),(0,a.Z)(this,v,{writable:!0,value:void 0}),(0,a.Z)(this,f,{writable:!0,value:void 0}),(0,o.Z)(this,u,!1),(0,o.Z)(this,l,!1),(0,o.Z)(this,d,!1),(0,o.Z)(this,h,[]),(0,o.Z)(this,p,new Promise(((e,s)=>{(0,o.Z)(this,v,e),(0,o.Z)(this,f,s);const r=t=>{(0,n.Z)(this,u)||(0,n.Z)(this,l)||(0,n.Z)(this,d)||(0,n.Z)(this,h).push(t)};return Object.defineProperty(r,"isResolved",{get:()=>(0,n.Z)(this,u)}),Object.defineProperty(r,"isRejected",{get:()=>(0,n.Z)(this,l)}),Object.defineProperty(r,"isCancelled",{get:()=>(0,n.Z)(this,d)}),t((t=>{(0,n.Z)(this,u)||(0,n.Z)(this,l)||(0,n.Z)(this,d)||((0,o.Z)(this,u,!0),(0,n.Z)(this,v)&&(0,n.Z)(this,v).call(this,t))}),(t=>{(0,n.Z)(this,u)||(0,n.Z)(this,l)||(0,n.Z)(this,d)||((0,o.Z)(this,l,!0),(0,n.Z)(this,f)&&(0,n.Z)(this,f).call(this,t))}),r)})))}get[i](){return"Cancellable Promise"}then(t,e){return(0,n.Z)(this,p).then(t,e)}catch(t){return(0,n.Z)(this,p).catch(t)}finally(t){return(0,n.Z)(this,p).finally(t)}cancel(){if(!((0,n.Z)(this,u)||(0,n.Z)(this,l)||(0,n.Z)(this,d))){if((0,o.Z)(this,d,!0),(0,n.Z)(this,h).length)try{for(const t of(0,n.Z)(this,h))t()}catch(t){return void console.warn("Cancellation threw an error",t)}(0,n.Z)(this,h).length=0,(0,n.Z)(this,f)&&(0,n.Z)(this,f).call(this,new c("Request aborted"))}}get isCancelled(){return(0,n.Z)(this,d)}}const b={BASE:"",VERSION:"1.0.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0};var w=s(64572);class Z extends Error{constructor(t,e,s){super(s),(0,w.Z)(this,"url",void 0),(0,w.Z)(this,"status",void 0),(0,w.Z)(this,"statusText",void 0),(0,w.Z)(this,"body",void 0),(0,w.Z)(this,"request",void 0),this.name="ApiError",this.url=e.url,this.status=e.status,this.statusText=e.statusText,this.body=e.body,this.request=t}}var m=s(19778).lW;const E=t=>void 0!==t&&null!==t,g=t=>"string"===typeof t,S=t=>g(t)&&""!==t,A=t=>"object"===typeof t&&"string"===typeof t.type&&"function"===typeof t.stream&&"function"===typeof t.arrayBuffer&&"function"===typeof t.constructor&&"string"===typeof t.constructor.name&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag]),T=t=>t instanceof FormData,C=t=>{const e=[],s=(t,r)=>{E(r)&&(Array.isArray(r)?r.forEach((e=>{s(t,e)})):"object"===typeof r?Object.entries(r).forEach((e=>{let[r,a]=e;s("".concat(t,"[").concat(r,"]"),a)})):((t,s)=>{e.push("".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(String(s))))})(t,r))};return Object.entries(t).forEach((t=>{let[e,r]=t;s(e,r)})),e.length>0?"?".concat(e.join("&")):""},O=async(t,e)=>"function"===typeof e?e(t):e,R=async(t,e)=>{const[s,r,a,n]=await Promise.all([O(e,t.TOKEN),O(e,t.USERNAME),O(e,t.PASSWORD),O(e,t.HEADERS)]),o=Object.entries({Accept:"application/json",...n,...e.headers}).filter((t=>{let[e,s]=t;return E(s)})).reduce(((t,e)=>{let[s,r]=e;return{...t,[s]:String(r)}}),{});if(S(s)&&(o.Authorization="Bearer ".concat(s)),S(r)&&S(a)){const t=(t=>{try{return btoa(t)}catch(e){return m.from(t).toString("base64")}})("".concat(r,":").concat(a));o.Authorization="Basic ".concat(t)}return void 0!==e.body&&(e.mediaType?o["Content-Type"]=e.mediaType:A(e.body)?o["Content-Type"]=e.body.type||"application/octet-stream":g(e.body)?o["Content-Type"]="text/plain":T(e.body)||(o["Content-Type"]="application/json")),new Headers(o)},_=(t,e)=>new y((async(s,r,a)=>{try{const r=((t,e)=>{const s=t.ENCODE_PATH||encodeURI,r=e.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((t,r)=>{var a;return null!==(a=e.path)&&void 0!==a&&a.hasOwnProperty(r)?s(String(e.path[r])):t})),a="".concat(t.BASE).concat(r);return e.query?"".concat(a).concat(C(e.query)):a})(t,e),n=(t=>{if(t.formData){const e=new FormData,s=(t,s)=>{g(s)||A(s)?e.append(t,s):e.append(t,JSON.stringify(s))};return Object.entries(t.formData).filter((t=>{let[e,s]=t;return E(s)})).forEach((t=>{let[e,r]=t;Array.isArray(r)?r.forEach((t=>s(e,t))):s(e,r)})),e}})(e),o=(t=>{var e;if(void 0!==t.body)return null!==(e=t.mediaType)&&void 0!==e&&e.includes("/json")?JSON.stringify(t.body):g(t.body)||A(t.body)||T(t.body)?t.body:JSON.stringify(t.body)})(e),i=await R(t,e);if(!a.isCancelled){const c=await(async(t,e,s,r,a,n,o)=>{const i=new AbortController,c={headers:n,body:null!==r&&void 0!==r?r:a,method:e.method,signal:i.signal};return t.WITH_CREDENTIALS&&(c.credentials=t.CREDENTIALS),o((()=>i.abort())),await fetch(s,c)})(t,e,r,o,n,i,a),u=await(async t=>{if(204!==t.status)try{const e=t.headers.get("Content-Type");if(e)return["application/json","application/problem+json"].some((t=>e.toLowerCase().startsWith(t)))?await t.json():await t.text()}catch(e){console.error(e)}})(c),l=((t,e)=>{if(e){const s=t.headers.get(e);if(g(s))return s}})(c,e.responseHeader),d={url:r,ok:c.ok,status:c.status,statusText:c.statusText,body:null!==l&&void 0!==l?l:u};((t,e)=>{const s={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...t.errors}[e.status];if(s)throw new Z(t,e,s);if(!e.ok){var r,a;const s=null!==(r=e.status)&&void 0!==r?r:"unknown",n=null!==(a=e.statusText)&&void 0!==a?a:"unknown",o=(()=>{try{return JSON.stringify(e.body,null,2)}catch(t){return}})();throw new Z(t,e,"Generic Error: status: ".concat(s,"; status text: ").concat(n,"; body: ").concat(o))}})(e,d),s(d.body)}}catch(n){r(n)}}));class k{static calculateSwap(t,e,s,r,a){return _(b,{method:"GET",url:"/v2/swap/calculate",query:{fromAsset:t,toAsset:e,fromAmount:s,referral:a,provider:r},errors:{500:"Default Response"}})}static encodeSwap(t){return _(b,{method:"POST",url:"/v2/swap/encode",body:t,mediaType:"application/json",errors:{500:"Default Response"}})}static swapGas(){return _(b,{method:"GET",url:"/v2/swap/gas",errors:{500:"Default Response"}})}static swapAssets(){return _(b,{method:"GET",url:"/v2/swap/assets",errors:{500:"Default Response"}})}}const P=()=>{const{config:t}=(0,r.bp)();return b.BASE=t.web_swaps_url,{swapService:k,referralAddress:t.web_swaps_referral_address,isSwapsEnabled:!!t.web_swaps_url}}}}]);
//# sourceMappingURL=976.01ee577c.chunk.js.map