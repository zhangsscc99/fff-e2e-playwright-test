"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[683],{83683:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Kr});var r=t(30168),s=t(80184),i=t(47712),o=t(65867),a=t(72791),l=t(5784),d=t(47578),c=t(72119),p=t(20504),u=t(61945),m=t(90820);const h=(0,a.forwardRef)(((e,n)=>{let{className:t,isDisabled:r}=e;const{t:i}=(0,u.$)(),[o,a]=(0,p.L)();return(0,s.jsx)(m.II,{value:o,onChange:e=>a(e),ref:n,disabled:r,label:i("swap_search"),clearButton:!0,className:t,size:"small"})}));var x,g,v,f,j=t(61819),w=t(87594),y=t(48544),b=t(88754);const A=o.zo.div(x||(x=(0,r.Z)(["\n    display: flex;\n    flex-direction: column;\n    text-align: center;\n"]))),S=(0,o.zo)(i.pN)(g||(g=(0,r.Z)(["\n    display: block;\n    margin-top: 4px;\n    color: ",";\n"])),(e=>e.theme.textSecondary)),k=o.zo.div(v||(v=(0,r.Z)(["\n    width: 100%;\n    display: flex;\n    gap: 8px;\n    margin-top: 24px;\n\n    > * {\n        flex: 1;\n    }\n"]))),C=(0,o.vJ)(f||(f=(0,r.Z)(["\n      .confirm-import-swap-token-notification {\n        ","\n      }\n    "])),(e=>"full-width"===e.theme.displayType&&"max-width: 400px;")),z=e=>{let{isOpen:n,onClose:t,tokenSymbol:r}=e;const{t:o}=(0,u.$)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C,{}),(0,s.jsx)(d.P_,{isOpen:n,handleClose:t,wrapperClassName:"confirm-import-swap-token-notification",children:()=>(0,s.jsxs)(A,{children:[(0,s.jsx)(i.fA,{children:o("swap_import_token_title").replace("%token%",r)}),(0,s.jsx)(S,{children:o("swap_unknown_token_description")}),(0,s.jsxs)(k,{children:[(0,s.jsx)(b.zx,{primary:!0,onClick:()=>t(!1),children:o("cancel")}),(0,s.jsx)(b.zx,{secondary:!0,onClick:()=>t(!0),children:o("swap_import")})]})]})})]})};var Z,_,T,O,P,E,F,N,D,R,M=t(23098),B=t(20220);const I=o.zo.div(Z||(Z=(0,r.Z)(["\n    overflow-y: auto;\n    width: calc(100% + 2rem);\n    margin: 0 -1rem;\n    height: calc(100% - 54px);\n\n    &::-webkit-scrollbar {\n        display: none;\n    }\n\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n"]))),K=o.zo.div(_||(_=(0,r.Z)(["\n    width: 100%;\n    height: 1px;\n    background-color: ",";\n"])),(e=>e.theme.separatorCommon)),U=e=>{let{walletSwapAssets:n,onSelect:t}=e;const[r,i]=(0,a.useState)(n.slice(0,25)),o=(0,a.useRef)(null);(0,a.useEffect)((()=>{i(n.slice(0,25))}),[n]);return(0,s.jsx)(I,{ref:o,onScroll:(0,B.P2)((()=>{if(null===o||void 0===o||!o.current)return;o.current.scrollHeight-o.current.clientHeight-o.current.scrollTop<300&&i((e=>n.slice(0,e.length+25)))}),100),children:n.length?r.map(((e,r)=>(0,s.jsxs)(a.Fragment,{children:[(0,s.jsx)(V,{onClick:()=>t(e.assetAmount.asset),swapAsset:e}),r!==n.length-1&&(0,s.jsx)(K,{})]},e.assetAmount.asset.id))):(0,s.jsx)(J,{onSelect:t})})},W=o.zo.div(T||(T=(0,r.Z)(["\n    height: 100%;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: ",";\n"])),(e=>e.theme.textSecondary)),J=e=>{let{onSelect:n}=e;const{t:t}=(0,u.$)(),{data:r,isFetching:o}=(0,p.UE)(),[d,c]=(0,a.useState)(!1),{mutate:m}=(0,p.bB)();if(o)return(0,s.jsx)(W,{children:(0,s.jsx)(l.L4,{})});if(!r)return(0,s.jsx)(W,{children:(0,s.jsx)(i.pN,{children:t("swap_tokens_not_found")})});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z,{isOpen:d,onClose:e=>{c(!1),e&&(m(r.assetAmount.asset),n(r.assetAmount.asset))},tokenSymbol:r.assetAmount.asset.symbol}),(0,s.jsx)(V,{onClick:()=>c(!0),swapAsset:r})]})},L=o.zo.button(O||(O=(0,r.Z)(["\n    border: none;\n    width: 100%;\n    padding: 8px 1rem;\n    display: flex;\n    gap: 12px;\n    background-color: transparent;\n\n    transition: background-color 0.15s ease-in-out;\n    cursor: pointer;\n\n    &:hover,\n    &:focus {\n        background-color: ",";\n    }\n"])),(e=>e.theme.backgroundContent)),q=o.zo.img(P||(P=(0,r.Z)(["\n    height: 40px;\n    width: 40px;\n    border-radius: 100%;\n"]))),$=o.zo.div(E||(E=(0,r.Z)(["\n    display: flex;\n    flex-direction: column;\n    width: calc(100% - 52px);\n"]))),Q=o.zo.div(F||(F=(0,r.Z)(["\n    display: flex;\n    align-items: center;\n    gap: 4px;\n\n    > *:first-child {\n        display: block;\n        overflow: hidden;\n        text-overflow: ellipsis;\n    }\n\n    > *:nth-child(3) {\n        margin-left: auto;\n    }\n"]))),G=o.zo.div(N||(N=(0,r.Z)(["\n    cursor: pointer;\n    &:hover {\n        > svg {\n            color: ",";\n        }\n    }\n"])),(e=>e.theme.iconSecondary)),H=(0,o.zo)(Q)(D||(D=(0,r.Z)(["\n    color: ",";\n\n    > *:nth-child(2) {\n        margin-left: auto;\n    }\n"])),(e=>e.theme.textSecondary)),Y=(0,o.zo)(i.fA)(R||(R=(0,r.Z)(["\n    color: ",";\n"])),(e=>e.isZero?e.theme.textTertiary:e.theme.textPrimary)),V=e=>{let{swapAsset:n,onClick:t}=e;const r=n.assetAmount.relativeAmount.isZero(),{fiat:o}=(0,w.bp)(),a=(0,M._H)();return(0,s.jsxs)(L,{onClick:t,children:[(0,s.jsx)(q,{src:n.assetAmount.asset.image}),(0,s.jsxs)($,{children:[(0,s.jsxs)(Q,{children:[(0,s.jsx)(i.fA,{children:n.assetAmount.asset.symbol}),(0,s.jsx)(G,{onClick:e=>{let t;e.preventDefault(),e.stopPropagation(),t=(0,y.kC)(n.assetAmount.asset.address)?"https://tonviewer.com/price":"https://tonviewer.com/".concat(n.assetAmount.asset.address.toString({urlSafe:!0})),a.openPage(t)},children:(0,s.jsx)(l.AT,{})}),(0,s.jsx)(Y,{isZero:r,children:n.assetAmount.stringRelativeAmount})]}),(0,s.jsxs)(H,{children:[(0,s.jsx)(i.De,{children:n.assetAmount.asset.name}),!r&&(0,s.jsx)(i.De,{children:(0,j.hE)(o,n.fiatAmount)})]})]})]})};var X,ee,ne,te,re,se,ie;const oe=(0,c.cn)(void 0),ae=(0,o.vJ)(X||(X=(0,r.Z)(["\n  .tokens-list-notification-wrapper .dialog-content {\n    padding-bottom: 0;\n  }\n"]))),le=()=>{const{t:e}=(0,u.$)(),[n,t]=(0,c.KO)(oe),r=e=>{null===n||void 0===n||n.onClose(e),t(void 0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ae,{}),(0,s.jsx)(d.P_,{isOpen:!!n,handleClose:()=>r(void 0),title:e("swap_tokens"),footer:(0,s.jsx)("div",{}),wrapperClassName:"tokens-list-notification-wrapper",children:()=>(0,s.jsx)(me,{onSelect:r})})]})},de=(0,o.zo)(h)(ee||(ee=(0,r.Z)(["\n    margin-bottom: 1rem;\n"]))),ce=o.zo.div(ne||(ne=(0,r.Z)(["\n    ","\n"])),(e=>"full-width"===e.theme.displayType?(0,o.iv)(te||(te=(0,r.Z)(["\n                  height: 580px;\n              "]))):(0,o.iv)(re||(re=(0,r.Z)(["\n                  height: calc(var(--app-height) - 6rem);\n              "]))))),pe=o.zo.div(se||(se=(0,r.Z)(["\n    width: calc(100% + 2rem);\n    margin: 0 -1rem;\n    height: 1px;\n    background-color: ",";\n"])),(e=>e.theme.separatorCommon)),ue=o.zo.div(ie||(ie=(0,r.Z)(["\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 300px;\n"]))),me=e=>{let{onSelect:n}=e;const t=(0,p.r7)(),r=(0,a.useRef)(),[i,o]=(0,p.L)();return(0,a.useEffect)((()=>(setTimeout((()=>{var e;return null===r||void 0===r||null===(e=r.current)||void 0===e?void 0:e.focus()}),100),()=>o(""))),[]),(0,s.jsxs)(ce,{children:[(0,s.jsx)(de,{ref:r,isDisabled:!t}),(0,s.jsx)(pe,{}),t?(0,s.jsx)(U,{onSelect:n,walletSwapAssets:t}):(0,s.jsx)(ue,{children:(0,s.jsx)(l.L4,{})})]})};var he,xe,ge;const ve=(0,o.zo)(i.fA)(he||(he=(0,r.Z)(["\n    display: block;\n    max-width: 80px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    flex-shrink: 0;\n    color: ",";\n\n    transition: color 0.15s ease-in-out;\n"])),(e=>e.theme.textPrimary)),fe=o.zo.button(xe||(xe=(0,r.Z)(["\n    border: none;\n    display: flex;\n    align-items: center;\n    background: none;\n    padding: 0;\n    cursor: pointer;\n    gap: 6px;\n    height: 36px;\n    width: fit-content;\n\n    &:hover {\n        > "," {\n            color: ",";\n        }\n    }\n"])),ve,(e=>e.theme.textSecondary)),je=o.zo.img(ge||(ge=(0,r.Z)(["\n    height: 24px;\n    width: 24px;\n    border-radius: 100%;\n    flex-shrink: 0;\n"]))),we=e=>{let{token:n,onTokenChange:t,className:r}=e;const i=(e=>{const[n,t]=(0,c.KO)(oe);return(0,a.useCallback)((()=>t((()=>({onClose:e})))),[t,e])})((0,a.useCallback)((e=>e&&t(e)),[t]));return(0,s.jsxs)(fe,{className:r,onClick:i,children:[(0,s.jsx)(je,{src:n.image}),(0,s.jsx)(ve,{children:n.symbol}),(0,s.jsx)(l.UR,{})]})};var ye,be=t(34692),Ae=t(27494),Se=t(12850),ke=t(144);const Ce=o.zo.input(ye||(ye=(0,r.Z)(["\n    border: none;\n    background: none;\n    text-align: right;\n    outline: none;\n    width: 30px;\n    color: ",";\n    font-family: inherit;\n\n    ","\n\n    &::placeholder {\n        color: ",";\n    }\n"])),(e=>e.isErrored?e.theme.accentRed:e.theme.textPrimary),i.Dv,(e=>e.theme.textTertiary));var ze,Ze=t(53006),_e=t(57443),Te=t(46320);const Oe=(0,o.zo)(i.De)(ze||(ze=(0,r.Z)(["\n    color: ",";\n    cursor: default;\n"])),(e=>e.theme.textSecondary)),Pe=e=>{let{amount:n,asset:t}=e;const{fiat:r}=(0,w.bp)(),{data:i,isLoading:o}=(0,_e.UJ)((0,y.J)(t.address));if(!n)return(0,s.jsx)("div",{});if(!o&&(null===i||void 0===i||!i.prices))return(0,s.jsx)("div",{});if(o)return(0,s.jsx)(Te.Od,{width:"80px",height:"12px",margin:"2px 0"});const a=(0,j.hE)(r,new be.Z(i.prices).multipliedBy(n));return(0,s.jsxs)(Oe,{children:["\u2248\xa0",a]})};var Ee,Fe,Ne,De=t(93853),Re=t(60793),Me=t(14182);const Be=(0,o.zo)(i.De)(Ee||(Ee=(0,r.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),Ie=o.zo.div(Fe||(Fe=(0,r.Z)(["\n    display: flex;\n    height: 16px;\n    align-items: center;\n"]))),Ke=o.zo.button(Ne||(Ne=(0,r.Z)(["\n    border: none;\n    background: none;\n    color: ",";\n    height: fit-content;\n    margin-left: 0.5rem;\n\n    > * {\n        display: block;\n        height: fit-content;\n    }\n\n    &:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n    }\n"])),(e=>e.theme.accentBlue)),Ue=()=>{const[e,n]=(0,Ze.y)(),[t]=(0,Ze.g7)(),{data:r}=(0,Ze.Fu)();return(0,s.jsx)(Je,{balance:r,decimals:t.decimals,onMax:()=>n((0,De.PE)(r,t.decimals))})},We=()=>{const[e]=(0,Ze.dN)(),n=(0,Re.h)({address:e.address,blockchain:Me.S.TON});return(0,s.jsx)(Je,{balance:n,decimals:e.decimals})},Je=e=>{let{balance:n,decimals:t=0,onMax:r}=e;const{t:o}=(0,u.$)(),a=(0,j.rs)();return(0,s.jsxs)(Ie,{children:[(0,s.jsxs)(Be,{children:[o("swap_balance"),":\xa0"]}),n?(0,s.jsx)(Be,{children:a(n,t)}):(0,s.jsx)(Te.Od,{width:"80px",height:"12px",margin:"2px 0"}),r&&(0,s.jsx)(Ke,{disabled:!n||n.isZero(),onClick:r,children:(0,s.jsx)(i.T3,{children:o("swap_max")})})]})};var Le,qe,$e,Qe,Ge,He;const Ye=o.zo.div(Le||(Le=(0,r.Z)(["\n    position: relative;\n    background: ",";\n    border-radius: ",";\n    padding: 6px 12px;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),Ve=o.zo.div(qe||(qe=(0,r.Z)(["\n    color: ",";\n    gap: 8px;\n    display: flex;\n\n    padding: 4px 0;\n\n    > *:first-child {\n        margin-right: auto;\n    }\n\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),Xe=o.zo.div($e||($e=(0,r.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 6px 0;\n"]))),en=o.zo.div(Qe||(Qe=(0,r.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 4px 0;\n    align-items: center;\n    height: 16px;\n\n    > * {\n        margin-left: auto;\n    }\n"]))),nn=(0,o.zo)(we)(Ge||(Ge=(0,r.Z)(["\n    flex-shrink: 0;\n"]))),tn=(0,o.zo)((e=>{let{value:n,onChange:t,decimals:r,className:i,isErrored:o}=e;const[l,d]=(0,a.useState)("");(0,a.useEffect)((()=>{if(n){if(!l.endsWith((0,Ae.Yz)()))try{new be.Z((0,ke.rf)(l).replace((0,Ae.Yz)(),".")).eq(n)||d((0,ke.jM)(n))}catch(e){}}else d("")}),[n]);const c=(0,Ae.Yz)();return(0,s.jsx)(Ce,{value:l,onChange:e=>(e=>{let n=(0,Se.VI)(e);if(!n)return d(""),void t(void 0);if((0,Se.vu)(n,r)&&(0,ke.kE)(n)){if(!n.endsWith((0,Ae.Yz)())){const e=new be.Z((0,ke.rf)(n).replace((0,Ae.Yz)(),".")),r=new be.Z((0,ke.rf)(l).replace((0,Ae.Yz)(),"."));e.eq(r)||(t(e),n=(0,ke.z6)(n))}d(n)}})(e.target.value),placeholder:"0".concat(c,"00"),className:i,isErrored:o,inputMode:"decimal"})}))(He||(He=(0,r.Z)(["\n    flex: 1;\n"]))),rn=e=>{let{children:n}=e;const{t:t}=(0,u.$)(),[r,o]=(0,Ze.y)(),[a,l]=(0,Ze.g7)(),{data:d}=(0,Ze.Fu)();return(0,s.jsxs)(Ye,{children:[(0,s.jsxs)(Ve,{children:[(0,s.jsx)(i.De,{children:t("swap_send")}),(0,s.jsx)(Ue,{})]}),(0,s.jsxs)(Xe,{children:[(0,s.jsx)(nn,{token:a,onTokenChange:l}),(0,s.jsx)(tn,{value:r,onChange:(0,B.Ds)(o),decimals:a.decimals,isErrored:!!d&&!!r&&r.gt((0,De.PE)(d,a.decimals))})]}),(0,s.jsx)(en,{children:(0,s.jsx)(Pe,{amount:r,asset:a})}),n]})};var sn=t(41235),on=t(76978),an=t(84879),ln=t(1849),dn=t(39079),cn=t(11707),pn=t(9356),un=t(97957),mn=t(94216);const hn=new Map,xn=["stonfi","dedust"],gn=(0,c.cn)([]);let vn=0;function fn(){const{api:e}=(0,w.bp)(),[n,t]=(0,c.KO)(gn),[r]=(0,Ze.g7)(),[s]=(0,Ze.dN)(),[i]=(0,Ze.y)(),[o,l]=(0,Ze.K4)(),d=(0,Ze.RM)(),{swapService:p}=(0,mn.W)(),u=(0,sn.useQuery)({queryKey:[un.S8.swapCalculate,r.id,s.id,null===i||void 0===i?void 0:i.shiftedBy(r.decimals).toFixed(0)],queryFn:async n=>{let{signal:o}=n;t([]),l(void 0),vn+=1;const a=vn;if(d)return[];Sn(r),Sn(s);const c=(0,De.$O)(i,r.decimals);let u=[];return new Promise(((n,i)=>{let d=0;xn.forEach((async m=>{try{const h=p.calculateSwap(jn(r.address),jn(s.address),c.toFixed(0),m);o&&(o.onabort=()=>h.cancel());const x=await h,g=await bn(x,e,r,s);if(a!==vn)return void i(new Error("Calculation cancelled"));const v=yn(g)[0];u=yn(u.concat(v)),u[0].trade&&l(u[0]),t((e=>yn([...e,v]))),d+=1,d===xn.length&&n(u)}catch(h){if(a!==vn)return void i(new Error("Calculation cancelled"));console.error(h);const e={provider:m,trade:null};u=yn(u.concat(e)),u[0].trade&&l(u[0]),t((n=>yn([...n,e]))),d+=1,d===xn.length&&n(u)}}))}))},cacheTime:0});return(0,a.useMemo)((()=>({...u,fetchedSwaps:n})),[u,n])}const jn=e=>(0,y.kC)(e)?"ton":e.toRawString(),wn=e=>"ton"===e?"TON":cn.Address.parse(e),yn=e=>e.slice().sort(((e,n)=>e.trade?n.trade?n.trade.to.weiAmount.comparedTo(e.trade.to.weiAmount):-1:1)),bn=async(e,n,t,r)=>{const s=await An(e.trades,n);if("dedust"===e.provider)return 0===e.trades.length?[{provider:"dedust",trade:null}]:e.trades.map((e=>({provider:"dedust",trade:{from:new on.n({asset:t,weiAmount:e.fromAmount}),to:new on.n({asset:r,weiAmount:e.toAmount}),path:e.path.map((e=>s.find((n=>(0,pn.A)(n.address,wn(e)))))),blockchainFee:new on.n({asset:ln.Ct,weiAmount:e.blockchainFee}),rawTrade:e.dedustRawTrade}})));if("stonfi"===e.provider){const n=e.trades[0];return n?[{provider:"stonfi",trade:{from:new on.n({asset:t,weiAmount:n.fromAmount}),to:new on.n({asset:r,weiAmount:n.toAmount}),blockchainFee:new on.n({asset:ln.Ct,weiAmount:n.blockchainFee}),rawTrade:n.stonfiRawTrade,path:n.path.map((e=>s.find((n=>(0,pn.A)(n.address,wn(e))))))}}]:[{provider:"stonfi",trade:null}]}return[]},An=async(e,n)=>{const t=e.flatMap((e=>e.path.map(wn)));return Promise.all(t.map((e=>kn(n,e))))},Sn=e=>{hn.has(e.address)||hn.set(e.address,Promise.resolve(e))},kn=async(e,n)=>{if((0,y.kC)(n))return ln.Ct;if(hn.has(n))return hn.get(n);const t=new an.EkG(e.tonApiV2).getJettonInfo({accountId:n.toRawString()}).then((e=>({symbol:e.metadata.symbol,decimals:Number(e.metadata.decimals),name:e.metadata.name,blockchain:Me.S.TON,address:n,id:(0,dn.G)(Me.S.TON,n),image:e.metadata.image})));return hn.set(n,t),t};var Cn=t(88674),zn=t(86445);const Zn=1,_n=.3,Tn=()=>{const e=(0,M._H)();return(0,sn.useQuery)([zn.l.SWAP_OPTIONS],(async()=>{const n=await e.storage.get(zn.l.SWAP_OPTIONS);return{slippagePercent:(null===n||void 0===n?void 0:n.slippagePercent)||Zn,maxPriceImpact:(null===n||void 0===n?void 0:n.maxPriceImpact)||_n}}))};var On,Pn,En,Fn,Nn,Dn,Rn,Mn,Bn,In,Kn,Un,Wn,Jn,Ln,qn=t(98605);const $n=o.zo.div(On||(On=(0,r.Z)([""]))),Qn=o.zo.div(Pn||(Pn=(0,r.Z)(["\n    cursor: pointer;\n    padding: 4px 0;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    color: ",";\n\n    svg {\n        color: ",";\n    }\n"])),(e=>e.theme.textSecondary),(e=>e.theme.textSecondary)),Gn=o.zo.div(En||(En=(0,r.Z)(["\n    transform: translateY(-100%);\n    visibility: hidden;\n    transition: transform 0.2s ease-in-out, visibility 0.2s ease-in-out;\n"]))),Hn=o.zo.div(Fn||(Fn=(0,r.Z)(["\n    display: grid;\n    grid-template-rows: ",";\n    overflow: ",";\n    transition: grid-template-rows 0.2s ease-in-out;\n\n    "," {\n        ","\n    }\n"])),(e=>e.isOpened?"1fr":"0fr"),(e=>e.animationCompleted&&e.isOpened?"visible":"hidden"),Gn,(e=>e.isOpened&&(0,o.iv)(Nn||(Nn=(0,r.Z)(["\n                transform: translateY(0);\n                visibility: visible;\n            "]))))),Yn=o.zo.div(Dn||(Dn=(0,r.Z)(["\n    min-height: 0;\n"]))),Vn=(0,o.zo)(Cn.h)(Rn||(Rn=(0,r.Z)(["\n    transform: ",";\n    transition: transform 0.2s ease-in-out;\n    border: none;\n"])),(e=>e.isOpened?"rotate(180deg)":"rotate(0deg)")),Xn=o.zo.div(Mn||(Mn=(0,r.Z)(["\n    position: relative;\n    display: flex;\n    padding: 4px 0;\n    gap: 6px;\n    align-items: center;\n\n    > * {\n        cursor: default;\n    }\n"]))),et=o.zo.div(Bn||(Bn=(0,r.Z)(["\n    pointer-events: none;\n    transform: translate3d(0, -10px, 0);\n    z-index: 100;\n    left: 0;\n    right: 0;\n    transition: all 0.15s ease-in-out;\n    opacity: 0;\n    position: absolute;\n    background-color: ",";\n    padding: 8px 12px;\n    ",";\n    ",";\n\n    ","\n"])),(e=>e.theme.backgroundContentTint),qn.G,i.C2,(e=>"top"===e.placement?(0,o.iv)(In||(In=(0,r.Z)(["\n                  transform: translate3d(0, 10px, 0);\n                  bottom: 30px;\n              "]))):(0,o.iv)(Kn||(Kn=(0,r.Z)(["\n                  transform: translate3d(0, -10px, 0);\n                  top: 30px;\n              "]))))),nt=o.zo.div(Un||(Un=(0,r.Z)(["\n    cursor: pointer;\n\n    &:hover + "," {\n        opacity: 1;\n        transform: translate3d(0, 0, 0);\n    }\n"])),et),tt=(0,o.zo)(i.De)(Wn||(Wn=(0,r.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),rt=(0,o.zo)(i.De)(Jn||(Jn=(0,r.Z)(["\n    margin-left: auto;\n"]))),st=()=>(0,s.jsx)(Te.Od,{width:"60px",height:"12px",margin:"2px 0"}),it=(0,o.zo)(i.De)(Ln||(Ln=(0,r.Z)(["\n    color: ",";\n"])),(e=>"low"===e.status?e.theme.accentGreen:"medium"===e.status||"unknown"===e.status?e.theme.accentOrange:e.theme.accentRed)),ot=()=>{const{t:e}=(0,u.$)(),[n,t]=(0,a.useState)(!1),[r,o]=(0,a.useState)(!1),d=(0,a.useRef)(),{isFetching:c}=fn(),[p]=(0,Ze.K4)(),m=(0,Ze.MT)(),{data:h}=Tn(),x=(0,Ze.RM)(),g=null===p||void 0===p?void 0:p.trade;if(!c&&!g||x)return null;return(0,s.jsxs)($n,{children:[(0,s.jsxs)(Qn,{onClick:()=>{clearTimeout(d.current),n?(o(!1),t(!1)):(t(!0),d.current=setTimeout((()=>o(!0)),400))},children:[(0,s.jsx)(i.De,{children:e("swap_tx_info")}),(0,s.jsx)(Vn,{transparent:!0,isOpened:n,children:(0,s.jsx)(l.v4,{})})]}),(0,s.jsx)(Hn,{isOpened:n,animationCompleted:r,children:(0,s.jsx)(Yn,{children:(0,s.jsxs)(Gn,{children:[(0,s.jsxs)(Xn,{children:[(0,s.jsx)(tt,{children:e("swap_price_impact")}),(0,s.jsx)(nt,{children:(0,s.jsx)(l.uM,{})}),(0,s.jsx)(et,{placement:"top",children:e("swap_price_impact_tooltip")}),(0,s.jsx)(rt,{children:void 0!==m&&g?(0,s.jsx)(it,{status:(0,Ze.DC)(m),children:m?(0,s.jsxs)(s.Fragment,{children:["\u2248\xa0","".concat(m.multipliedBy(100).decimalPlaces(2).toString().replace(".",(0,Ae.Yz)()).replace("-","+"),"%")]}):e("swap_unknown_price_impact")}):(0,s.jsx)(st,{})})]}),(0,s.jsxs)(Xn,{children:[(0,s.jsx)(tt,{children:e("swap_minimum_received")}),(0,s.jsx)(nt,{children:(0,s.jsx)(l.uM,{})}),(0,s.jsx)(et,{placement:"top",children:e("swap_minimum_received_tooltip")}),(0,s.jsx)(rt,{children:g&&h?(0,s.jsxs)(i.De,{children:["\u2248\xa0",new on.n({weiAmount:g.to.weiAmount.multipliedBy(100-h.slippagePercent).div(100),asset:g.to.asset}).stringAssetRelativeAmount]}):(0,s.jsx)(st,{})})]}),(0,s.jsxs)(Xn,{children:[(0,s.jsx)(tt,{children:e("swap_slippage")}),(0,s.jsx)(nt,{children:(0,s.jsx)(l.uM,{})}),(0,s.jsx)(et,{placement:"top",children:e("swap_slippage_tooltip")}),(0,s.jsx)(rt,{children:g&&h?(0,s.jsxs)(i.De,{children:[h.slippagePercent,"%"]}):(0,s.jsx)(st,{})})]}),(0,s.jsxs)(Xn,{children:[(0,s.jsx)(tt,{children:e("swap_blockchain_fee")}),(0,s.jsx)(nt,{children:(0,s.jsx)(l.uM,{})}),(0,s.jsx)(et,{placement:"top",children:e("swap_blockchain_fee_tooltip")}),(0,s.jsx)(rt,{children:g?(0,s.jsxs)(i.De,{children:["\u2248\xa0",g.blockchainFee.stringAssetRelativeAmount]}):(0,s.jsx)(st,{})})]}),(0,s.jsxs)(Xn,{children:[(0,s.jsx)(tt,{children:e("swap_route")}),(0,s.jsx)(rt,{children:g?(0,s.jsx)(i.De,{children:g.path.map((e=>e.symbol)).join(" \u2192 ")}):(0,s.jsx)(st,{})})]})]})})})]})};var at,lt;const dt=(0,o.zo)(i.De)(at||(at=(0,r.Z)(["\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    color: ",";\n    cursor: pointer;\n    transition: color 0.15s ease-in-out;\n\n    &:hover {\n        ",";\n    }\n"])),(e=>"medium"===e.impact?e.theme.accentOrange:"high"===e.impact?e.theme.accentRed:e.theme.textSecondary),(e=>"medium"!==e.impact&&"high"!==e.impact&&(0,o.iv)(lt||(lt=(0,r.Z)(["\n                color: ",";\n            "])),e.theme.textPrimary))),ct=()=>(0,s.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.18144 1.65C4.63413 0.86592 4.86047 0.473881 5.11842 0.286474C5.64415 -0.0954914 6.35604 -0.0954914 6.88177 0.286474C7.13971 0.473881 7.36606 0.86592 7.81875 1.65L11.1096 7.35L11.1097 7.35001C11.5623 8.13408 11.7887 8.52612 11.822 8.84321C11.8899 9.48949 11.534 10.106 10.9403 10.3703C10.6491 10.5 10.1964 10.5 9.29099 10.5H2.7092C1.80382 10.5 1.35113 10.5 1.05986 10.3703C0.466204 10.106 0.110258 9.48949 0.178184 8.84321C0.211512 8.52612 0.437856 8.13408 0.890544 7.35L4.18144 1.65ZM5.1001 8.1C5.1001 7.60294 5.50304 7.2 6.0001 7.2C6.49715 7.2 6.9001 7.60294 6.9001 8.1C6.9001 8.59706 6.49715 9 6.0001 9C5.50304 9 5.1001 8.59706 5.1001 8.1ZM6.00002 2C5.53718 2 5.16822 2.38674 5.18997 2.84906L5.31946 5.60072C5.33656 5.96414 5.63619 6.25 6.00002 6.25C6.36384 6.25 6.66347 5.96414 6.68057 5.60072L6.81006 2.84906C6.83182 2.38674 6.46285 2 6.00002 2Z",fill:"currentColor"})}),pt=()=>{const[e,n]=(0,a.useState)("from"),[t]=(0,Ze.K4)(),{isFetching:r}=fn(),i=(0,Ze.MT)(),o=r&&!(null!==t&&void 0!==t&&t.trade)||void 0===i;if(!r&&!(null!==t&&void 0!==t&&t.trade))return null;if(o)return(0,s.jsx)(Te.Od,{width:"100px",height:"12px",margin:"2px 0"});const l=t.trade,d="from"===e?l.from:l.to,c="from"===e?l.to:l.from;if(d.relativeAmount.isZero())return null;const p=c.relativeAmount.div(d.relativeAmount),u=on.n.fromRelativeAmount({amount:p,asset:c.asset}),m=(0,Ze.DC)(i);return(0,s.jsxs)(dt,{impact:m,onClick:()=>n((e=>"from"===e?"to":"from")),children:["1\xa0",d.asset.symbol,"\xa0\u2248\xa0",u.stringAssetRelativeAmount,("medium"===m||"high"===m)&&(0,s.jsx)(ct,{})]})};var ut,mt,ht,xt,gt,vt,ft;const jt=o.zo.div(ut||(ut=(0,r.Z)(["\n    background: ",";\n    border-radius: ",";\n    padding: 6px 12px;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),wt=o.zo.div(mt||(mt=(0,r.Z)(["\n    color: ",";\n    gap: 8px;\n    display: flex;\n\n    padding: 4px 0;\n\n    > *:first-child {\n        margin-right: auto;\n    }\n\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),yt=o.zo.div(ht||(ht=(0,r.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 6px 0;\n"]))),bt=o.zo.div(xt||(xt=(0,r.Z)(["\n    margin-left: auto;\n    overflow: auto;\n\n    cursor: default;\n\n    &::-webkit-scrollbar {\n        display: none;\n    }\n\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n"]))),At=o.zo.div(gt||(gt=(0,r.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 4px 0;\n    align-items: center;\n    height: 16px;\n\n    > :last-child {\n        margin-left: auto;\n    }\n"]))),St=(0,o.zo)(we)(vt||(vt=(0,r.Z)(["\n    flex-shrink: 0;\n"]))),kt=(0,o.zo)(i.J1)(ft||(ft=(0,r.Z)(["\n    color: ",";\n"])),(e=>e.theme.textTertiary)),Ct=()=>{var e;const{t:n}=(0,u.$)(),[t,r]=(0,Ze.dN)(),{isFetching:o}=fn(),[a]=(0,Ze.K4)();return(0,s.jsxs)(jt,{children:[(0,s.jsxs)(wt,{children:[(0,s.jsx)(i.De,{children:n("swap_receive")}),(0,s.jsx)(We,{})]}),(0,s.jsxs)(yt,{children:[(0,s.jsx)(St,{token:t,onTokenChange:r}),(0,s.jsx)(bt,{children:null!==a&&void 0!==a&&a.trade||!o?null!==a&&void 0!==a&&a.trade?(0,s.jsx)(i.J1,{children:a.trade.to.stringRelativeAmount}):(0,s.jsx)(kt,{children:"0"}):(0,s.jsx)(Te.Od,{width:"100px",height:"28px",margin:"4px 0"})})]}),(0,s.jsxs)(At,{children:[(0,s.jsx)(pt,{}),(0,s.jsx)(Pe,{amount:null===a||void 0===a||null===(e=a.trade)||void 0===e?void 0:e.to.relativeAmount,asset:t})]}),(0,s.jsx)(ot,{})]})};var zt=t(29681);const Zt=e=>{let{onClick:n,isEncodingProcess:t}=e;const{t:r}=(0,u.$)(),[i]=(0,Ze.y)(),[o]=(0,Ze.g7)(),{data:a}=(0,Ze.Fu)(),{isFetching:l,data:d}=fn(),[c]=(0,Ze.K4)(),p=(0,Ze.MT)(),{data:m}=Tn(),h=(0,Ze.RM)();if((0,zt.vO)())return(0,s.jsx)(b.zx,{size:"medium",secondary:!0,disabled:!0,children:r("swap_ledger_not_supported")});if(h)return(0,s.jsx)(b.zx,{size:"medium",secondary:!0,disabled:!0,children:r("swap_enter_amount")});if(!l&&null!==d&&void 0!==d&&d.every((e=>!e.trade)))return(0,s.jsx)(b.zx,{size:"medium",disabled:!0,children:r("swap_trade_is_not_available")});if(l&&(null===c||void 0===c||!c.trade)||!a||void 0===p||!m)return(0,s.jsx)(b.zx,{size:"medium",secondary:!0,loading:!0,children:r("continue")});if(!c||!c.trade)return(0,s.jsx)(b.zx,{size:"medium",secondary:!0,disabled:!0,children:r("swap_trade_is_not_available")});if(null===i||void 0===i?void 0:i.gt((0,De.PE)(a,o.decimals)))return(0,s.jsx)(b.zx,{size:"medium",secondary:!0,disabled:!0,children:r("swap_not_enough_funds")});return(null===p||void 0===p?void 0:p.gt(m.maxPriceImpact))?(0,s.jsx)(b.zx,{size:"medium",secondary:!0,disabled:!0,children:r("swap_price_impact_too_high")}):(0,s.jsx)(b.zx,{size:"medium",primary:!0,onClick:n,loading:t,children:r("continue")})};var _t=t(22245);const Tt=e=>"stonfi"===e.provider?{provider:"stonfi",stonfiTrade:e.trade.rawTrade}:"dedust"===e.provider?{provider:"dedust",dedustTrade:e.trade.rawTrade}:void function(e){throw new Error("Didn't expect to get here")}();var Ot,Pt,Et,Ft,Nt,Dt,Rt,Mt=t(57689),Bt=t(29305);const It=o.zo.div(Ot||(Ot=(0,r.Z)(["\n    padding: 0 12px 12px;\n    background: ",";\n    border-radius: ",";\n    height: fit-content;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),Kt=o.zo.div(Pt||(Pt=(0,r.Z)(["\n    color: ",";\n    padding: 10px 0;\n    display: flex;\n    align-items: center;\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),Ut=()=>{const{t:e}=(0,u.$)();return(0,Ze.RM)()?(0,s.jsx)("div",{}):(0,s.jsxs)(It,{children:[(0,s.jsx)(Kt,{children:(0,s.jsx)(i.De,{children:e("swap_provider")})}),(0,s.jsx)(Gt,{provider:"stonfi"}),(0,s.jsx)(Gt,{provider:"dedust"})]})},Wt=o.zo.div(Et||(Et=(0,r.Z)(["\n    height: 56px;\n    border-radius: ",";\n    border: 1px solid ",";\n    padding: 0 12px;\n    display: flex;\n    gap: 0.5rem;\n    align-items: center;\n    cursor: ",";\n\n    transition: border-color 0.15s ease-in-out;\n\n    &:not(:last-child) {\n        margin-bottom: 8px;\n    }\n"])),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall),(e=>e.isActive?e.theme.accentBlue:e.theme.separatorCommon),(e=>e.isDisabled?"not-allowed":"pointer")),Jt=o.zo.img(Ft||(Ft=(0,r.Z)(["\n    width: 24px;\n    height: 24px;\n    border-radius: 6px;\n"]))),Lt=o.zo.div(Nt||(Nt=(0,r.Z)(["\n    padding: 10px 0;\n    display: flex;\n    flex-direction: column;\n"]))),qt=o.zo.div(Dt||(Dt=(0,r.Z)(["\n    padding: 10px 0;\n    margin-left: auto;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n"]))),$t=(0,o.zo)(i.De)(Rt||(Rt=(0,r.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),Qt={stonfi:{imageUrl:"https://wallet.tonkeeper.com/img/swap/stonfi.png",label:"STON.fi"},dedust:{imageUrl:"https://wallet.tonkeeper.com/img/swap/dedust.png",label:"DeDust"}},Gt=e=>{let{provider:n}=e;const{t:t}=(0,u.$)(),[r,o]=(0,Ze.K4)(),a=(null===r||void 0===r?void 0:r.provider)===n,{fetchedSwaps:l,isFetching:d}=fn(),c=l.find((e=>e.provider===n)),p=null===c||void 0===c?void 0:c.trade,[m]=(0,Ze.dN)(),{data:h,isFetching:x}=(0,_e.UJ)((0,y.J)(m.address)),g=0===l.findIndex((e=>e.provider===n))&&!(null===c||void 0===c||!c.trade),v=Qt[n],{fiatAmount:f}=(0,_e.to)(h,(null===p||void 0===p?void 0:p.to.relativeAmount)||new be.Z(0));return(0,s.jsxs)(Wt,{isDisabled:!c||!p,isActive:a,onClick:()=>c&&p&&o(c),children:[(0,s.jsx)(Jt,{src:v.imageUrl}),(0,s.jsxs)(Lt,{children:[(0,s.jsx)(i.fA,{children:v.label}),g&&(0,s.jsx)($t,{children:t("swap_best_price")})]}),(0,s.jsx)(qt,{children:d||p?(0,s.jsxs)(s.Fragment,{children:[p?(0,s.jsx)(i.fA,{children:p.to.stringAssetRelativeAmount}):(0,s.jsx)(Te.Od,{width:"60px",height:"14px",margin:"3px 0"}),h&&p?(0,s.jsxs)($t,{children:["\u2248\xa0",f]}):x?(0,s.jsx)(Te.Od,{width:"60px",height:"12px",margin:"2px 0"}):(0,s.jsx)("div",{})]}):(0,s.jsx)($t,{children:t("swap_trade_is_not_available")})})]})};var Ht,Yt,Vt=t(35976);const Xt=o.zo.div(Ht||(Ht=(0,r.Z)(["\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n"]))),er=(0,o.zo)(Cn.h)(Yt||(Yt=(0,r.Z)(["\n    height: 32px;\n    width: 32px;\n    position: absolute;\n    right: calc(50% - 16px);\n    bottom: -20px;\n    border: none;\n\n    background-color: ",";\n\n    > svg {\n        transition: color 0.15s ease-in-out;\n    }\n\n    &:hover {\n        background-color: ",";\n        > svg {\n            color: ",";\n        }\n    }\n"])),(e=>e.theme.buttonTertiaryBackground),(e=>e.theme.buttonTertiaryBackgroundHighlighted),(e=>e.theme.iconPrimary)),nr=e=>{let{className:n}=e;const t=(0,o.Fg)(),{isLoading:r,mutateAsync:i}=function(){const{active:e}=(0,w.tN)(),{swapService:n}=(0,mn.W)(),{config:t}=(0,w.bp)(),{data:r}=Tn(),s=t.web_swaps_referral_address;return(0,sn.useMutation)((t=>{if(!r)throw new Error("SwapOptions query was not resolved yet");return n.encodeSwap({swap:Tt(t),options:{senderAddress:e.rawAddress,slippage:new be.Z(r.slippagePercent).div(100).decimalPlaces(5).toString(),...s&&{referralAddress:cn.Address.parse(s).toRawString()}}})}))}(),[d,c]=(0,a.useState)(null),[p]=(0,Ze.K4)(),[u,m]=(0,Ze.g7)(),[h,x]=(0,Ze.dN)(),[g,v]=(0,Ze.y)(),f=(0,Mt.s0)(),[j,y]=(0,Vt.J)();return(0,s.jsxs)(Xt,{className:n,children:[(0,s.jsx)(rn,{children:(0,s.jsx)(er,{onClick:()=>{m(h),x(u),null!==p&&void 0!==p&&p.trade&&v(p.trade.to.relativeAmount)},children:(0,s.jsx)(l.Td,{})})}),(0,s.jsx)(Ct,{}),"compact"===t.displayType&&(0,s.jsx)(Ut,{}),(0,s.jsx)(Zt,{onClick:async()=>{const e=await i(p);c({valid_until:(Date.now()+6e5)/1e3,messages:[{address:cn.Address.parse(e.to).toString({bounceable:!0}),amount:e.value,payload:e.body}]})},isEncodingProcess:r||!!d}),(0,s.jsx)(_t.o,{handleClose:e=>{c(null),e&&(f(Bt.FR.activity),y(!1))},params:d,waitInvalidation:!0}),(0,s.jsx)(le,{})]})},tr=(0,a.createContext)(null),rr={didCatch:!1,error:null};class sr extends a.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=rr}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var n,t,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];null===(n=(t=this.props).onReset)||void 0===n||n.call(t,{args:s,reason:"imperative-api"}),this.setState(rr)}}componentDidCatch(e,n){var t,r;null===(t=(r=this.props).onError)||void 0===t||t.call(r,e,n)}componentDidUpdate(e,n){const{didCatch:t}=this.state,{resetKeys:r}=this.props;var s,i;t&&null!==n.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==n.length||e.some(((e,t)=>!Object.is(e,n[t])))}(e.resetKeys,r)&&(null===(s=(i=this.props).onReset)||void 0===s||s.call(i,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(rr))}render(){const{children:e,fallbackRender:n,FallbackComponent:t,fallback:r}=this.props,{didCatch:s,error:i}=this.state;let o=e;if(s){const e={error:i,resetErrorBoundary:this.resetErrorBoundary};if("function"===typeof n)o=n(e);else if(t)o=(0,a.createElement)(t,e);else{if(null!==r&&!(0,a.isValidElement)(r))throw i;o=r}}return(0,a.createElement)(tr.Provider,{value:{didCatch:s,error:i,resetErrorBoundary:this.resetErrorBoundary}},o)}}var ir,or;const ar=o.zo.label(ir||(ir=(0,r.Z)(["\n    cursor: pointer;\n    ",";\n    ",";\n    box-sizing: border-box;\n\n    text-align: center;\n\n    padding: 8px 12px;\n\n    background: ",";\n    border: 1px solid transparent;\n    transition: border-color 0.15s ease-in-out;\n"])),qn.G,i.C2,(e=>e.theme.fieldBackground)),lr=o.zo.input(or||(or=(0,r.Z)(["\n    display: none;\n\n    &:checked + "," {\n        border: 1px solid ",";\n    }\n"])),ar,(e=>e.theme.accentBlue)),dr=(0,a.forwardRef)(((e,n)=>{const t=(0,a.useId)(),r=e.id||t,{className:i,children:o,...l}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(lr,{type:"radio",ref:n,id:r,...l}),(0,s.jsx)(ar,{className:i,htmlFor:r,children:o})]})}));var cr,pr,ur,mr,hr;const xr=e=>{let{isOpen:n,onClose:t}=e;const{t:r}=(0,u.$)();return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(d.P_,{isOpen:n,handleClose:t,title:r("swap_settings"),children:()=>(0,s.jsx)(Ar,{onClose:t})})})},gr=o.zo.div(cr||(cr=(0,r.Z)(["\n    padding-bottom: 10px;\n\n    > * {\n        display: block;\n        cursor: default;\n    }\n\n    > "," {\n        color: ",";\n    }\n"])),i.De,(e=>e.theme.textSecondary)),vr=o.zo.div(pr||(pr=(0,r.Z)(["\n    display: flex;\n    gap: 0.5rem;\n    margin-bottom: 2rem;\n"]))),fr=(0,o.zo)(dr)(ur||(ur=(0,r.Z)(["\n    height: 36px;\n    flex: 1;\n"]))),jr=o.zo.div(mr||(mr=(0,r.Z)(["\n    display: flex;\n    gap: 0.5rem;\n    > * {\n        flex: 1;\n    }\n"]))),wr=[.5,1,3,5],yr=wr[1],br=o.zo.div(hr||(hr=(0,r.Z)(["\n    height: 200px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n"]))),Ar=e=>{let{onClose:n}=e;const{t:t}=(0,u.$)(),{data:r}=Tn(),{mutate:o}=(()=>{const e=(0,M._H)(),n=(0,sn.useQueryClient)();return(0,sn.useMutation)((async t=>{const r=await e.storage.get(zn.l.SWAP_OPTIONS);await e.storage.set(zn.l.SWAP_OPTIONS,{...r,...t}),await n.invalidateQueries([zn.l.SWAP_OPTIONS])}))})(),[d,c]=(0,a.useState)();if((0,a.useLayoutEffect)((()=>{null!==r&&void 0!==r&&r.slippagePercent&&(wr.includes(null===r||void 0===r?void 0:r.slippagePercent)?c(null===r||void 0===r?void 0:r.slippagePercent):(c(yr),o({slippagePercent:yr})))}),[null===r||void 0===r?void 0:r.slippagePercent]),!r)return(0,s.jsx)(br,{children:(0,s.jsx)(l.L4,{})});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(gr,{children:[(0,s.jsx)(i.fA,{children:t("swap_slippage")}),(0,s.jsx)(i.De,{children:t("swap_slippage_description")})]}),(0,s.jsx)(vr,{children:wr.map((e=>(0,s.jsxs)(fr,{name:"slippage-percent",value:e,checked:d===e,onChange:()=>c(e),children:[e,"%"]},e)))}),(0,s.jsxs)(jr,{children:[(0,s.jsx)(b.zx,{secondary:!0,onClick:n,children:t("cancel")}),(0,s.jsx)(b.zx,{primary:!0,disabled:d===r.slippagePercent,onClick:()=>{o({slippagePercent:d}),null===n||void 0===n||n()},children:t("save")})]})]})};var Sr;const kr=(0,o.zo)(Cn.h)(Sr||(Sr=(0,r.Z)(["\n    padding: 10px;\n    border: none;\n\n    > svg {\n        color: ",";\n    }\n\n    transition: opacity 0.15s ease-in-out;\n\n    &:hover {\n        opacity: 0.64;\n    }\n"])),(e=>e.theme.iconSecondary)),Cr=()=>{const[e,n]=(0,a.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(kr,{transparent:!0,onClick:()=>n(!0),children:(0,s.jsx)(l.bZ,{})}),(0,s.jsx)(xr,{isOpen:e,onClose:()=>n(!1)})]})};var zr;const Zr=(0,o.zo)(Cn.h)(zr||(zr=(0,r.Z)(["\n    padding: 10px;\n    border: none;\n\n    > svg {\n        color: ",";\n    }\n\n    transition: opacity 0.15s ease-in-out;\n\n    &:hover {\n        opacity: 0.64;\n    }\n"])),(e=>e.theme.iconSecondary));let _r=!1;const Tr=()=>{const{refetch:e,isFetching:n}=fn(),[t,r]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{if(_r=!1,!n){r(!0);const n=setTimeout((()=>{_r||(e(),_r=!0)}),15e3);return()=>clearTimeout(n)}r(!1)}),[n]),(0,s.jsx)(Zr,{transparent:!0,onClick:()=>e(),children:t?(0,s.jsx)(l.ut,{}):(0,s.jsx)(l.Du,{})})};var Or,Pr,Er,Fr;const Nr=o.zo.div(Or||(Or=(0,r.Z)(["\n    position: relative;\n"]))),Dr=o.zo.div(Pr||(Pr=(0,r.Z)(["\n    display: flex;\n"]))),Rr=(0,o.zo)(i.fA)(Er||(Er=(0,r.Z)(["\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 5rem;\n    right: 2rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: transparent;\n"]))),Mr=()=>(0,s.jsxs)(Nr,{children:[(0,s.jsxs)(Dr,{children:[(0,s.jsx)(Tr,{}),(0,s.jsx)(Cr,{})]}),(0,s.jsx)(Rr,{children:"Swap"})]}),Br=o.zo.div(Fr||(Fr=(0,r.Z)(["\n    overflow-y: auto;\n    min-height: calc(var(--app-height) - 7rem);\n"]))),Ir=()=>(0,s.jsx)(Br,{children:(0,s.jsx)(nr,{})}),Kr=()=>{const[e,n]=(0,Vt.J)();return(0,s.jsx)(sr,{fallbackRender:(t="Failed to display Swap page",e=>{let{error:n}=e;return(0,s.jsxs)("div",{role:"alert",children:[(0,s.jsx)("p",{children:t}),(0,s.jsx)("p",{children:"Something went wrong:"}),(0,s.jsx)("pre",{style:{color:"red"},children:n.message})]})}),children:(0,s.jsx)(d.P_,{isOpen:e,handleClose:()=>n(!1),title:(0,s.jsx)(Mr,{}),hideButton:!0,children:()=>(0,s.jsx)(Ir,{})})});var t}},20504:(e,n,t)=>{t.d(n,{Iy:()=>A,L:()=>k,UE:()=>z,bB:()=>_,r7:()=>C});var r=t(41235),s=t(97957),i=t(48544),o=t(11707),a=t(39079),l=t(14182),d=t(76978),c=t(60793),p=t(34692),u=t(57443),m=t(93853),h=t(87594),x=t(72119),g=t(72791),v=t(20220),f=t(94216),j=t(91153),w=t(84879),y=t(23098),b=t(86445);function A(){const{swapService:e}=(0,f.W)(),{data:n}=Z();return(0,r.useQuery)({queryKey:[s.S8.swapAllAssets,n],queryFn:async()=>{try{const t=await e.swapAssets();return t.map((e=>{const n="ton"===e.address?"TON":o.Address.parse(e.address);return{id:(0,a.G)(l.S.TON,n),symbol:e.symbol,decimals:e.decimals,name:e.name,image:e.image,blockchain:l.S.TON,address:n}})).filter((e=>!(n||[]).some((n=>n.id===e.id)))).concat(n||[])}catch(t){return console.error(t),[]}},enabled:!!n})}const S=(0,x.cn)("");function k(){return(0,x.KO)(S)}const C=()=>{const[e]=k(),{data:n}=function(){const[e]=(0,c.L)(),{data:n}=A(),{data:t}=(0,u.UJ)(l.C.TON),{fiat:a}=(0,h.bp)();return(0,r.useQuery)({queryKey:[s.S8.swapWalletAssets,n,e,t,a],queryFn:async()=>{if(!e||!n||!t)return[];const r=n.map((n=>{var r;if((0,i.kC)(n.address))return{assetAmount:new d.n({asset:n,weiAmount:e.ton.info.balance}),fiatAmount:(0,m.PE)(new p.Z(e.ton.info.balance)).multipliedBy(t.prices)};const s=e.ton.jettons.balances.find((e=>o.Address.parse(e.jetton.address).equals(n.address)));return{assetAmount:new d.n({asset:n,weiAmount:(null===s||void 0===s?void 0:s.balance)||0}),fiatAmount:(0,m.PE)(new p.Z((null===s||void 0===s?void 0:s.balance)||0),n.decimals).multipliedBy(new p.Z((null===s||void 0===s||null===(r=s.price)||void 0===r||null===(r=r.prices)||void 0===r?void 0:r[a])||0))}}));return r.sort(((e,n)=>e.fiatAmount.isZero()&&n.fiatAmount.isZero()?n.assetAmount.weiAmount.comparedTo(e.assetAmount.weiAmount):n.fiatAmount.comparedTo(e.fiatAmount))),r},enabled:!!e&&!!n&&!!t})}();return(0,g.useMemo)((()=>{if(n)return n.filter((n=>{var t;if(!e)return!0;if((0,v.Ig)(e))return o.Address.parse(e).equals(n.assetAmount.asset.address);const r=e.toUpperCase();return!!(n.assetAmount.asset.symbol.toUpperCase().includes(r)||null!==(t=n.assetAmount.asset.name)&&void 0!==t&&t.toUpperCase().includes(r))||void 0}))}),[e,n])},z=()=>{const[e]=k(),n=(0,v.Ig)(e),{api:t,fiat:i}=(0,h.bp)(),{data:c}=(0,j.oJ)();return(0,r.useQuery)({queryKey:[s.S8.swapCustomToken,e,c,i],queryFn:async()=>{if(!n)return null;try{var r;const n=o.Address.parse(e),s=await new w.EkG(t.tonApiV2).getJettonInfo({accountId:n.toRawString()}),u={address:n,image:s.metadata.image,blockchain:l.S.TON,name:s.metadata.name,symbol:s.metadata.symbol,decimals:Number(s.metadata.decimals),id:(0,a.G)(l.S.TON,n)},h=null===c||void 0===c?void 0:c.balances.find((e=>o.Address.parse(e.jetton.address).equals(n)));return{assetAmount:new d.n({asset:u,weiAmount:(null===h||void 0===h?void 0:h.balance)||new p.Z(0)}),fiatAmount:(0,m.PE)(new p.Z((null===h||void 0===h?void 0:h.balance)||0),u.decimals).multipliedBy(new p.Z((null===h||void 0===h||null===(r=h.price)||void 0===r||null===(r=r.prices)||void 0===r?void 0:r[i])||0))}}catch(s){return console.error(s),null}},enabled:n&&!!c})},Z=()=>{const e=(0,y._H)();return(0,r.useQuery)([b.l.SWAP_CUSTOM_ASSETS],(async()=>{const n=await e.storage.get(b.l.SWAP_CUSTOM_ASSETS);return(null===n||void 0===n?void 0:n.map((e=>({...e,blockchain:e.blockchain,address:(0,i.Wx)(e.address),id:(0,a.G)(e.blockchain,e.address)}))))||[]}))},_=()=>{const e=(0,y._H)(),n=(0,r.useQueryClient)();return(0,r.useMutation)((async t=>{const r=await e.storage.get(b.l.SWAP_CUSTOM_ASSETS)||[];await e.storage.set(b.l.SWAP_CUSTOM_ASSETS,[...r,{...t,address:(0,i.J)(t.address)}]),await n.invalidateQueries([b.l.SWAP_CUSTOM_ASSETS])}))}}}]);
//# sourceMappingURL=683.1e712def.chunk.js.map